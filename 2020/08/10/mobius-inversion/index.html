<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="参考：大佬1 大佬2 大佬3 大佬4P3455 [POI2007]ZAP-Queries$$求解\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m[gcd(i,j)&#x3D;k]$$ $反演过程：$ $$\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m[gcd(i,j)&#x3D;k]$$ $$\sum_{i&#x3D;1}^{\left \lfloor \">
<meta property="og:type" content="article">
<meta property="og:title" content="莫比乌斯反演例题集---（自用）">
<meta property="og:url" content="https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/index.html">
<meta property="og:site_name" content="jujimeizuo · Blog">
<meta property="og:description" content="参考：大佬1 大佬2 大佬3 大佬4P3455 [POI2007]ZAP-Queries$$求解\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m[gcd(i,j)&#x3D;k]$$ $反演过程：$ $$\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m[gcd(i,j)&#x3D;k]$$ $$\sum_{i&#x3D;1}^{\left \lfloor \">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200815153844583.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Z6dHNpbGx5,size_16,color_FFFFFF,t_70##pic_center">
<meta property="article:published_time" content="2020-08-10T13:37:05.000Z">
<meta property="article:modified_time" content="2024-04-01T11:19:02.709Z">
<meta property="article:author" content="jujimeizuo">
<meta property="article:tag" content="ACM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20200815153844583.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Z6dHNpbGx5,size_16,color_FFFFFF,t_70##pic_center">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>莫比乌斯反演例题集---（自用）</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GNY9KG3NWK"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-GNY9KG3NWK');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="jujimeizuo · Blog" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Articles</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/jujimeizuo/">Projects</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://note.jujimeizuo.cn/">Note</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2020/08/12/luogu-p2051/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2020/08/09/2020-nowcoder-shujia-9-e/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&text=莫比乌斯反演例题集---（自用）"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&title=莫比乌斯反演例题集---（自用）"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&is_video=false&description=莫比乌斯反演例题集---（自用）"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=莫比乌斯反演例题集---（自用）&body=Check out this article: https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&title=莫比乌斯反演例题集---（自用）"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&title=莫比乌斯反演例题集---（自用）"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&title=莫比乌斯反演例题集---（自用）"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&title=莫比乌斯反演例题集---（自用）"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&name=莫比乌斯反演例题集---（自用）&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&t=莫比乌斯反演例题集---（自用）"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83%EF%BC%9A%E5%A4%A7%E4%BD%AC1-%E5%A4%A7%E4%BD%AC2-%E5%A4%A7%E4%BD%AC3-%E5%A4%A7%E4%BD%AC4"><span class="toc-number">1.</span> <span class="toc-text">参考：大佬1 大佬2 大佬3 大佬4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#P3455-POI2007-ZAP-Queries"><span class="toc-number">2.</span> <span class="toc-text">P3455 [POI2007]ZAP-Queries</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P2257-YY%E7%9A%84GCD"><span class="toc-number">1.</span> <span class="toc-text">P2257 YY的GCD</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-1"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P1390-%E5%85%AC%E7%BA%A6%E6%95%B0%E7%9A%84%E5%92%8C"><span class="toc-number">1.</span> <span class="toc-text">P1390 公约数的和</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-2"><span class="toc-number"></span> <span class="toc-text">Code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P1829-%E5%9B%BD%E5%AE%B6%E9%9B%86%E8%AE%AD%E9%98%9F-Crash%E7%9A%84%E6%95%B0%E5%AD%97%E8%A1%A8%E6%A0%BC-JZPTAB"><span class="toc-number"></span> <span class="toc-text">P1829 [国家集训队]Crash的数字表格 &#x2F; JZPTAB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-3"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P3768-%E7%AE%80%E5%8D%95%E7%9A%84%E6%95%B0%E5%AD%A6%E9%A2%98"><span class="toc-number">1.</span> <span class="toc-text">P3768 简单的数学题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-4"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P3327-SDOI2015-%E7%BA%A6%E6%95%B0%E4%B8%AA%E6%95%B0%E5%92%8C"><span class="toc-number">1.</span> <span class="toc-text">P3327 [SDOI2015]约数个数和</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-5"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P3312-SDOI2014-%E6%95%B0%E8%A1%A8"><span class="toc-number">1.</span> <span class="toc-text">P3312 [SDOI2014]数表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-6"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P3172-CQOI2015-%E9%80%89%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">P3172 [CQOI2015]选数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-7"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AT5200-AGC038C-LCMs"><span class="toc-number">1.</span> <span class="toc-text">AT5200 [AGC038C] LCMs</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-8"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SP5971-LCMSUM-LCM-Sum"><span class="toc-number">1.</span> <span class="toc-text">SP5971 LCMSUM - LCM Sum</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-9"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P5221-Product"><span class="toc-number">1.</span> <span class="toc-text">P5221 Product</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-10"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HDU-6588-Function"><span class="toc-number">1.</span> <span class="toc-text">HDU 6588 Function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HDU-6833-A-Very-Easy-Math-Problem"><span class="toc-number">2.</span> <span class="toc-text">HDU 6833 A Very Easy Math Problem</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-11"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#huntian-oy"><span class="toc-number">1.</span> <span class="toc-text">huntian oy</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-12"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HDU-6428-Problem-C-Calculate"><span class="toc-number">1.</span> <span class="toc-text">HDU 6428 Problem C. Calculate</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-13"><span class="toc-number"></span> <span class="toc-text">Code</span></a>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        莫比乌斯反演例题集---（自用）
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">jujimeizuo</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-08-10T13:37:05.000Z" class="dt-published" itemprop="datePublished">2020-08-10</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/ACM/" rel="tag">ACM</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h4 id="参考：大佬1-大佬2-大佬3-大佬4"><a href="#参考：大佬1-大佬2-大佬3-大佬4" class="headerlink" title="参考：大佬1 大佬2 大佬3 大佬4"></a>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44282912/article/details/105417215">大佬1</a> <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43973966/article/details/85338976">大佬2</a> <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/blog/Althen-Way-Satan/mu-bi-wu-si-fan-yan-yu-du-jiao-shai">大佬3</a> <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/blog/An-Amazing-Blog/mu-bi-wu-si-fan-yan-ji-ge-ji-miao-di-dong-xi">大佬4</a></h4><h4 id="P3455-POI2007-ZAP-Queries"><a href="#P3455-POI2007-ZAP-Queries" class="headerlink" title="P3455 [POI2007]ZAP-Queries"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3455">P3455 [POI2007]ZAP-Queries</a></h4><p>$$求解\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m[gcd(i,j)&#x3D;k]$$ $反演过程：$ $$\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m[gcd(i,j)&#x3D;k]$$</p>
<p>$$\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor \frac{m}{k} \right \rfloor}\varepsilon[gcd(i,j)&#x3D;1]$$</p>
<p>$枚举d：$</p>
<p>$$\sum_{d&#x3D;1}^{\left \lfloor min(\left \lfloor \frac{n}{k} \right \rfloor,\left \lfloor \frac{m}{k} \right \rfloor)\right \rfloor}\mu(d)\left \lfloor \frac{n}{kd} \right \rfloor \left \lfloor \frac{m}{kd} \right \rfloor$$</p>
<p>$\ {先预处理\mu，然后整数分块做，复杂度为O(n + T\sqrt n)}$</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">long</span> ll;</span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">double</span> ld;</span><br><span class="line">typedef pair&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; pdd;</span><br><span class="line"></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> INF 0x7f7f7f</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> FOR(i, x, n) for(int i = x;i &lt;= n; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="comment">// const int maxn = 1e5 + 10;</span></span><br><span class="line"><span class="comment">// const double eps = 1e-6;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> mu[N]; <span class="comment">// 莫比乌斯函数</span></span><br><span class="line"><span class="built_in">bool</span> <span class="keyword">is</span>\_prime[N];</span><br><span class="line"><span class="built_in">int</span> prime[N];</span><br><span class="line"><span class="built_in">int</span> cnt;</span><br><span class="line"></span><br><span class="line">ll sum[N]; <span class="comment">// 记录莫比乌斯函数前缀和</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Mobi</span>() <span class="comment">// 莫比乌斯函数初始化</span></span></span><br><span class="line">&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">is</span>\_prime[<span class="number">0</span>] = <span class="keyword">is</span>\_prime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">2</span>;i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">is</span>\_prime[i]) &#123;</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">            prime[++cnt] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; i \* prime[j] &lt; N; j++) &#123;</span><br><span class="line">            <span class="keyword">is</span>\_prime[i \* prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                mu[i \* prime[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i \* prime[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt; N; i++) &#123;</span><br><span class="line">        sum[i] = sum[i - <span class="number">1</span>] + mu[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll k;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Ans</span>(<span class="params">ll n, ll m</span>)</span> &#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    n /= k, m /= k;</span><br><span class="line">    <span class="built_in">int</span> mx = min(n, m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> l = <span class="number">1</span>, r;l &lt;= mx; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = min(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (n / l) \* (m / l) \* (sum[r] - sum[l - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span>()</span> &#123;</span><br><span class="line">    Mobi();</span><br><span class="line">    <span class="built_in">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span>(T--) &#123;</span><br><span class="line">        ll n, m;</span><br><span class="line">        cin &gt;&gt; n &gt;&gt; m &gt;&gt; k;</span><br><span class="line">        cout &lt;&lt; Ans(n, m) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">signed <span class="title">main</span>()</span> &#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">//cout.tie(nullptr);</span></span><br><span class="line"><span class="meta">##ifdef FZT\_ACM\_LOCAL</span></span><br><span class="line">    freopen(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    freopen(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    signed test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) exit(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        auto start\_clock\_for\_debug = clock();</span><br><span class="line">        solve();</span><br><span class="line">        auto end\_clock\_for\_debug = clock();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.putback(acm\_local\_for\_debug));</span><br><span class="line"><span class="meta">##<span class="keyword">else</span></span></span><br><span class="line">    solve();</span><br><span class="line"><span class="meta">##<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="P2257-YY的GCD"><a href="#P2257-YY的GCD" class="headerlink" title="P2257 YY的GCD"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2257">P2257 YY的GCD</a></h4><p>$$求解\sum_{p\in prime}\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m[gcd(i,j)&#x3D;p]$$ $反演过程和上面几乎一样，就多了一维p为质数的情况，直接化简为：$</p>
<p>$$\sum_{p\in prime}\sum_{d&#x3D;1}^{\left \lfloor min(\left \lfloor \frac{n}{p} \right \rfloor,\left \lfloor \frac{m}{p} \right \rfloor)\right \rfloor}\mu(d)\left \lfloor \frac{n}{pd} \right \rfloor \left \lfloor \frac{m}{pd} \right \rfloor$$</p>
<p>$这里的复杂度为O(n+T\sqrt n \sqrt n)，但明显不够，所以需要继续化简，这里的优化可以用T替换pd，则d&#x3D;\frac{T}{p}，替换后的式子为：$</p>
<p>$$\sum_{T&#x3D;1}^{min(n,m)})\left \lfloor \frac{n}{T} \right \rfloor \left \lfloor \frac{m}{T} \right \rfloor\sum_{pT\;p\in prime}\mu(\frac{T}{p})$$</p>
<p>$$令\ {F(x)&#x3D;\sum_{px\;p\in prime}\mu(\frac{x}{p})}$$</p>
<p>$得：$</p>
<p>$$\sum_{p\in prime}\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m[gcd(i,j)&#x3D;p]&#x3D;\sum_{T&#x3D;1}^{min(n,m)}\left \lfloor \frac{n}{T} \right \rfloor \left \lfloor \frac{m}{T} \right \rfloor F(T)$$</p>
<p>$\ {O(n)处理\mu，O(nlogn)处理F，O(\sqrt n)询问分块，即复杂度为O(nlogn + T\sqrt n)}$</p>
<h2 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">long</span> ll;</span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">double</span> ld;</span><br><span class="line">typedef pair&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; pdd;</span><br><span class="line"></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> INF 0x7f7f7f</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> FOR(i, x, n) for(int i = x;i &lt;= n; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="comment">// const int maxn = 1e5 + 10;</span></span><br><span class="line"><span class="comment">// const double eps = 1e-6;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">1e7</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> mu[N]; <span class="comment">// 莫比乌斯函数</span></span><br><span class="line"><span class="built_in">bool</span> <span class="keyword">is</span>\_prime[N];</span><br><span class="line"><span class="built_in">int</span> prime[N];</span><br><span class="line"><span class="built_in">int</span> cnt;</span><br><span class="line"></span><br><span class="line">ll sum[N]; <span class="comment">// 记录莫比乌斯函数前缀和</span></span><br><span class="line">ll F[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Mobi</span>() <span class="comment">// 莫比乌斯函数初始化</span></span></span><br><span class="line">&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">is</span>\_prime[<span class="number">0</span>] = <span class="keyword">is</span>\_prime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">2</span>;i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">is</span>\_prime[i]) &#123;</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">            prime[++cnt] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; i \* prime[j] &lt; N; j++) &#123;</span><br><span class="line">            <span class="keyword">is</span>\_prime[i \* prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                mu[i \* prime[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i \* prime[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt;= cnt; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> j = <span class="number">1</span>;j \* prime[i] &lt; N; j++) &#123;</span><br><span class="line">            F[j \* prime[i]] += mu[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt; N; i++) &#123;</span><br><span class="line">        F[i] += F[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll k;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Ans</span>(<span class="params">ll N, ll M</span>)</span> &#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    ll n = N, m = M;</span><br><span class="line">    <span class="built_in">int</span> mx = min(n, m);</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> l = <span class="number">1</span>, r; l &lt;= mx; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = min(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (n / l) \* (m / l) \* (F[r] - F[l - <span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span>()</span> &#123;</span><br><span class="line">    Mobi();</span><br><span class="line">    <span class="built_in">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span>(T--) &#123;</span><br><span class="line">        ll n, m;</span><br><span class="line">        cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">        cout &lt;&lt; Ans(n, m) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">signed <span class="title">main</span>()</span> &#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">//cout.tie(nullptr);</span></span><br><span class="line"><span class="meta">##ifdef FZT\_ACM\_LOCAL</span></span><br><span class="line">    freopen(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    freopen(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    signed test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) exit(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        auto start\_clock\_for\_debug = clock();</span><br><span class="line">        solve();</span><br><span class="line">        auto end\_clock\_for\_debug = clock();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.putback(acm\_local\_for\_debug));</span><br><span class="line"><span class="meta">##<span class="keyword">else</span></span></span><br><span class="line">    solve();</span><br><span class="line"><span class="meta">##<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="P1390-公约数的和"><a href="#P1390-公约数的和" class="headerlink" title="P1390 公约数的和"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1390">P1390 公约数的和</a></h4><p>$$求解\sum_{i&#x3D;1}^n\sum_{j&#x3D;i+1}^ngcd(i,j)$$</p>
<p>$先来看看基本形式：$ $$\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^ngcd(i,j)$$ $则\ {ans&#x3D;\frac{Calc(n,n)-\frac{n(n+1)}{2}}{2}}，首先减去gcd(i,i)的个数\frac{n(n+1)}{2}，然后减去gcd(i,j)&#x3D;gcd(j,i)的个数，直接除2即可，则：$ $$\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^n\sum_{k&#x3D;1}^nk[gcd(i,j)&#x3D;k]$$</p>
<p>$枚举k：$</p>
<p>$$\sum_{k&#x3D;1}^nk\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\sum_{j&#x3D;\left \lfloor \frac{i+1}{k} \right \rfloor}^{\left \lfloor \frac{n}{k} \right \rfloor}[gcd(i,j)&#x3D;1]$$</p>
<p>$$\sum_{k&#x3D;1}^nk\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\sum_{di\;dj}\mu(d)$$</p>
<p>$$\sum_{k&#x3D;1}^nk\sum_{d&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\mu(d)\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{kd} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor \frac{n}{kd} \right \rfloor}1$$</p>
<p>$$\sum_{k&#x3D;1}^nk\sum_{d&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\mu(d)(\left \lfloor \frac{n}{kd} \right \rfloor)^2$$</p>
<p>$令\ {T&#x3D;kd并枚举T}，得：$</p>
<p>$$\sum_{T&#x3D;1}^n\sum_{dT}\mu(d)\frac{T}{d}(\left \lfloor \frac{n}{T} \right \rfloor)^2$$</p>
<p>$中间部分有\ {\sum_{dT}\mu(d)\frac{T}{d}&#x3D;\varphi (T)，因为\varphi &#x3D;\mu * id}，即得：$</p>
<p>$$\sum_{T&#x3D;1}^n\varphi (T)(\left \lfloor \frac{n}{T} \right \rfloor)^2$$</p>
<p>$则最终答案为：$</p>
<p>$$\ {ans&#x3D;\frac{\sum_{T&#x3D;1}^n\varphi (T)(\left \lfloor \frac{n}{T} \right \rfloor)^2-\frac{n(n+1)}{2}}{2}}$$</p>
<p>$\ {O(n)预处理\varphi，\sqrt n询问分块，总时间复杂度为O(n+\sqrt n)}$</p>
<h3 id="Code-2"><a href="#Code-2" class="headerlink" title="Code"></a>Code</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">long</span> ll;</span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">double</span> ld;</span><br><span class="line">typedef pair&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; pdd;</span><br><span class="line"></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> INF 0x7f7f7f</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> FOR(i, x, n) for(int i = x;i &lt;= n; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="comment">// const ll P = 1e9 + 7;</span></span><br><span class="line"><span class="comment">// const int maxn = 1e5 + 10;</span></span><br><span class="line"><span class="comment">// const double eps = 1e-6;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">2e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> phi[N];</span><br><span class="line"><span class="built_in">bool</span> <span class="keyword">is</span>\_prime[N];</span><br><span class="line"><span class="built_in">int</span> prime[N];</span><br><span class="line"><span class="built_in">int</span> tot;</span><br><span class="line"></span><br><span class="line">ll f[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Euler</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">is</span>\_prime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">2</span>;i &lt; N; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">is</span>\_prime[i]) &#123;</span><br><span class="line">            phi[i] = i - <span class="number">1</span>;</span><br><span class="line">            prime[++tot] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> j = <span class="number">1</span>;j &lt;= tot &amp;&amp; i \* prime[j] &lt; N; j++)&#123;</span><br><span class="line">            <span class="keyword">is</span>\_prime[i \* prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(i % prime[j]) &#123;</span><br><span class="line">                phi[i \* prime[j]] = phi[i] \* (prime[j] - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                phi[i \* prime[j]] = phi[i] \* prime[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt; N; i++) &#123;</span><br><span class="line">        f[i] = f[i - <span class="number">1</span>] + phi[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Calc</span>(<span class="params">ll n</span>)</span> &#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(ll l = <span class="number">1</span>, r;l &lt;= n;l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = min(n, n / (n / l));</span><br><span class="line">        ans += (f[r] - f[l - <span class="number">1</span>]) \* (n / l) \* (n / l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span>()</span> &#123;</span><br><span class="line">    Euler();</span><br><span class="line">    ll n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    cout &lt;&lt; (Calc(n) - n \* (n + <span class="number">1</span>) / <span class="number">2</span>) / <span class="number">2</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">signed <span class="title">main</span>()</span> &#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">//cout.tie(nullptr);</span></span><br><span class="line"><span class="meta">##ifdef FZT\_ACM\_LOCAL</span></span><br><span class="line">    freopen(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    freopen(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    signed test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) exit(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        auto start\_clock\_for\_debug = clock();</span><br><span class="line">        solve();</span><br><span class="line">        auto end\_clock\_for\_debug = clock();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.putback(acm\_local\_for\_debug));</span><br><span class="line"><span class="meta">##<span class="keyword">else</span></span></span><br><span class="line">    solve();</span><br><span class="line"><span class="meta">##<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="P1829-国家集训队-Crash的数字表格-JZPTAB"><a href="#P1829-国家集训队-Crash的数字表格-JZPTAB" class="headerlink" title="P1829 [国家集训队]Crash的数字表格 &#x2F; JZPTAB"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1829">P1829 [国家集训队]Crash的数字表格 &#x2F; JZPTAB</a></h3><p>$$求解\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^mlcm (i,j)$$</p>
<p>$由gcd和lcm之间的关系得：$</p>
<p>$$\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m\frac{ij}{gcd(i,j)}$$</p>
<p>$$\sum_{k&#x3D;1}^{min(n,m)}\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m\frac{ij}{k}[gcd(i,j)&#x3D;k]$$</p>
<p>$$\sum_{k&#x3D;1}^{min(n,m)}\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor \frac{m}{k} \right \rfloor}\frac{ijk^2}{k}[gcd(i,j)&#x3D;1]$$</p>
<p>$$\sum_{k&#x3D;1}^{min(n,m)}k\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor \frac{m}{k} \right \rfloor}ij\sum_{di\;dj}\mu(d)$$</p>
<p>$枚举d得：$</p>
<p>$$\sum_{k&#x3D;1}^{min(n,m)}k\sum_{d&#x3D;1}^{min(\left \lfloor \frac{n}{k} \right \rfloor,\left \lfloor \frac{m}{k} \right \rfloor)}\mu(d)\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{kd} \right \rfloor}id\sum_{j&#x3D;1}^{\left \lfloor \frac{m}{kd} \right \rfloor}jd$$</p>
<p>$$\sum_{k&#x3D;1}^{min(n,m)}k\sum_{d&#x3D;1}^{min(\left \lfloor \frac{n}{k} \right \rfloor,\left \lfloor \frac{m}{k} \right \rfloor)}\mu(d)d^2\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{kd} \right \rfloor}i\sum_{j&#x3D;1}^{\left \lfloor \frac{m}{kd} \right \rfloor}j$$</p>
<p>$令\ {f(x)&#x3D;\sum_{i&#x3D;1}^{x}i，F(n,m)&#x3D;\sum_{d&#x3D;1}^{min(n,m)}\mu(d)d^2f(\frac{n}{d})f(\frac{m}{d})}，得：$</p>
<p>$$\sum_{k&#x3D;1}^{min(n,m)}kF(\left \lfloor\frac{n}{k}\right \rfloor,\left \lfloor\frac{m}{k}\right \rfloor)$$</p>
<p>$\ {O(n)处理\mu,O(1)处理f（等差数列，在计算F的过程中直接直接计算），O(\sqrt {\sqrt n})分块询问F，答案分块询问O(\sqrt n)，总复杂度为O(n+n^{\frac{3}{4}})}$</p>
<h3 id="Code-3"><a href="#Code-3" class="headerlink" title="Code"></a>Code</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">long</span> ll;</span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">double</span> ld;</span><br><span class="line">typedef pair&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; pdd;</span><br><span class="line"></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> INF 0x7f7f7f</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> FOR(i, x, n) for(int i = x;i &lt;= n; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="comment">// const int maxn = 1e5 + 10;</span></span><br><span class="line"><span class="comment">// const double eps = 1e-6;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">1e7</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ll mod = <span class="number">20101009</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> mu[N]; <span class="comment">// 莫比乌斯函数</span></span><br><span class="line"><span class="built_in">bool</span> <span class="keyword">is</span>\_prime[N];</span><br><span class="line"><span class="built_in">int</span> prime[N];</span><br><span class="line"><span class="built_in">int</span> cnt;</span><br><span class="line"></span><br><span class="line">ll sum[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Mobi</span>() <span class="comment">// 莫比乌斯函数初始化</span></span></span><br><span class="line">&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">is</span>\_prime[<span class="number">0</span>] = <span class="keyword">is</span>\_prime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">2</span>;i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">is</span>\_prime[i]) &#123;</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">            prime[++cnt] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; i \* prime[j] &lt; N; j++) &#123;</span><br><span class="line">            <span class="keyword">is</span>\_prime[i \* prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                mu[i \* prime[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i \* prime[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt; N; i++) &#123;</span><br><span class="line">        sum[i] = (sum[i - <span class="number">1</span>] + mu[i] \* i % mod \* i % mod) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Ans</span>(<span class="params">ll n, ll m</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ll inv2 = (mod + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    ll p = min(n, m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> k = <span class="number">1</span>;k &lt;= p; k++) &#123;</span><br><span class="line">        <span class="built_in">int</span> x = n / k, y = m / k, P = min(x, y);</span><br><span class="line">        ll Sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> l = <span class="number">1</span>, r;l &lt;= P; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">            r = min(x / (x / l), (y / (y / l)));</span><br><span class="line">            Sum = (Sum + (sum[r] - sum[l - <span class="number">1</span>] + mod) % mod \* (<span class="number">1</span> + x / l) % mod \* (x / l) % mod \* inv2 % mod \* (<span class="number">1</span> + y / l) % mod \* (y / l) % mod \* inv2 % mod) % mod;</span><br><span class="line">        &#125;</span><br><span class="line">        ans = (ans + Sum \* k % mod) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span>()</span> &#123;</span><br><span class="line">    Mobi();</span><br><span class="line">    ll n, m;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    cout &lt;&lt; Ans(n, m) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">signed <span class="title">main</span>()</span> &#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">//cout.tie(nullptr);</span></span><br><span class="line"><span class="meta">##ifdef FZT\_ACM\_LOCAL</span></span><br><span class="line">    freopen(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    freopen(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    signed test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) exit(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        auto start\_clock\_for\_debug = clock();</span><br><span class="line">        solve();</span><br><span class="line">        auto end\_clock\_for\_debug = clock();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.putback(acm\_local\_for\_debug));</span><br><span class="line"><span class="meta">##<span class="keyword">else</span></span></span><br><span class="line">    solve();</span><br><span class="line"><span class="meta">##<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="P3768-简单的数学题"><a href="#P3768-简单的数学题" class="headerlink" title="P3768 简单的数学题"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3768">P3768 简单的数学题</a></h4><p>$$求解\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^nij(gcd(i,j))\;mod \;p$$ $$\sum_{k&#x3D;1}^n\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^nijk[gcd(i,j)&#x3D;k]$$</p>
<p>$$\sum_{k&#x3D;1}^nk\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}ijk^2[gcd(i,j)&#x3D;1]$$</p>
<p>$$\sum_{k&#x3D;1}^nk^3\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}ij\sum_{di\;dj}\mu(d)$$</p>
<p>$$\sum_{k&#x3D;1}^nk^3\sum_{d&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\mu(d)\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{kd} \right \rfloor}id\sum_{j&#x3D;1}^{\left \lfloor \frac{n}{kd} \right \rfloor}jd$$</p>
<p>$$\sum_{k&#x3D;1}^nk^3\sum_{d&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\mu(d)d^2\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{kd} \right \rfloor}i\sum_{j&#x3D;1}^{\left \lfloor \frac{n}{kd} \right \rfloor}j$$</p>
<p>$令\ {f(x)&#x3D;\sum_{i&#x3D;1}^xi}，则式子变为：$</p>
<p>$$\sum_{k&#x3D;1}^nk^3\sum_{d&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\mu(d)d^2f^2(\frac{n}{kd})$$</p>
<p>$到这里，时间复杂度为O(n+n\sqrt n)，我没尝试过，但是还可以继续化简，化简方法有替换，用T替换kd，则：$</p>
<p>$$\sum_{T&#x3D;1}^nf^2(\frac{n}{T})T^2\sum_{kT}k*\mu(\frac{T}{k})$$</p>
<p>$$\sum_{T&#x3D;1}^nf^2(\frac{n}{T})T^2\ {(id*\mu)T}$$</p>
<p>$$\sum_{T&#x3D;1}^nf^2(\frac{n}{T})T^2\ {\varphi (T)}$$</p>
<p>$\ {可以杜教筛筛T^2\varphi (T)的前缀和，因为n最高有10^{10}，明显数组存不下，所以对于5e6可以用数组直接过度求前缀和，对于后面就可以用杜教筛求前缀和，然后用map存下（STL的好处），过程如下：}$</p>
<p>$参考：$<a target="_blank" rel="noopener" href="https://www.luogu.com.cn/blog/Althen-Way-Satan/mu-bi-wu-si-fan-yan-yu-du-jiao-shai">杜教筛</a></p>
<p>$先看杜教筛的基本形式(与上面无关)：设S(n)&#x3D;\sum_{i&#x3D;1}^{n}f(i)，定义一个新函数为g，则有$</p>
<p>$$\sum_{i&#x3D;1}^n(f*g)i$$</p>
<p>$$\sum_{i&#x3D;1}^n\sum_{xy&#x3D;i}f(x)g(y)$$</p>
<p>$$\sum_{y&#x3D;1}^ng(y)\sum_{xy\leq n}f(x)$$</p>
<p>$$\sum_{y&#x3D;1}^ng(y)\sum_{x&#x3D;1}^{\left \lfloor \frac{n}{y} \right \rfloor}f(x)$$</p>
<p>$$\sum_{y&#x3D;1}^ng(y)S(\left \lfloor \frac{n}{y} \right \rfloor)$$</p>
<p>$则有：$</p>
<p>$$\sum_{i&#x3D;1}^n(f*g)i&#x3D;g(1)S(n)+\sum_{y&#x3D;2}^ng(y)S(\left \lfloor \frac{n}{y} \right \rfloor)$$</p>
<p>$$\ {S(n)&#x3D;\frac{\sum_{i&#x3D;1}^n(f*g)i-\sum_{y&#x3D;2}^ng(y)S(\left \lfloor \frac{n}{y} \right \rfloor)}{g(1)}}$$</p>
<p>$对于本题，要找到合适的g函数，因为我们求的前缀和为S(n)&#x3D;\sum_{i&#x3D;1}^ni^2\varphi(i),f(i)&#x3D;i^2\varphi(i)，所以设g(n)&#x3D;n^2。$</p>
<p>$\sum_{i&#x3D;1}^ng(i)&#x3D;\frac{x(x+1)(2x+1)}{6}$</p>
<p>$(f*g)x&#x3D;\sum_{dx}f(d)g(\frac{x}{d})&#x3D;\sum_{dx}d^2\varphi(d)\frac{x^2}{d^2}&#x3D;x^2\sum_{dx}\varphi(d)&#x3D;x^2id(x)&#x3D;x^3$</p>
<p>$\sum_{i&#x3D;1}^n(f*g)i&#x3D;\sum_{i&#x3D;1}^ni^3&#x3D;\frac{x^2(x+1)^2}{4}$</p>
<p>$$\ {S(n)&#x3D;\frac{n^2(n+1)^2}{4}-\sum_{y&#x3D;2}^ng(y)S(\left \lfloor \frac{n}{y} \right \rfloor)}$$</p>
<p>$\ {O(n^{\frac{2}{3}})处理T^2\varphi (T)的前缀和，f可以O(1)算出，O(\sqrt n) 询问分块，总时间复杂度为O(n^\frac{2}{3})}$</p>
<h3 id="Code-4"><a href="#Code-4" class="headerlink" title="Code"></a>Code</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">long</span> ll;</span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">double</span> ld;</span><br><span class="line">typedef pair&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; pdd;</span><br><span class="line"></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> INF 0x7f7f7f</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> FOR(i, x, n) for(int i = x;i &lt;= n; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="comment">// const int maxn = 1e5 + 10;</span></span><br><span class="line"><span class="comment">// const double eps = 1e-6;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">5e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">ll n, mod, inv4, inv6;</span><br><span class="line">ll phi[N];</span><br><span class="line"><span class="built_in">bool</span> <span class="keyword">is</span>\_prime[N];</span><br><span class="line"><span class="built_in">int</span> prime[N];</span><br><span class="line"><span class="built_in">int</span> tot;</span><br><span class="line"></span><br><span class="line">ll sum[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Get\_phi() &#123;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">is</span>\_prime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">2</span>;i &lt;= N; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">is</span>\_prime[i]) &#123;</span><br><span class="line">            phi[i] = i - <span class="number">1</span>;</span><br><span class="line">            prime[++tot] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> j = <span class="number">1</span>;j &lt;= tot &amp;&amp; i \* prime[j] &lt; N; j++)&#123;</span><br><span class="line">            <span class="keyword">is</span>\_prime[i \* prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(i % prime[j]) &#123;</span><br><span class="line">                phi[i \* prime[j]] = phi[i] \* (prime[j] - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                phi[i \* prime[j]] = phi[i] \* prime[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt; N; i++) &#123;</span><br><span class="line">        sum[i] = (sum[i - <span class="number">1</span>] + (ll)phi[i] \* i % mod \* i % mod) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll quick\_pow(ll a, ll b) &#123;</span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)&#123;</span><br><span class="line">        <span class="keyword">if</span>(b &amp; <span class="number">1</span>) ans = ans \* a % mod;</span><br><span class="line">        a = a \* a % mod;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">sum1</span>(<span class="params">ll x</span>)</span> &#123;x %= mod; <span class="keyword">return</span> (<span class="number">1</span> + x) % mod \* x % mod \* (<span class="number">1</span> + x) % mod \* x % mod \* inv4 % mod;&#125;</span><br><span class="line"><span class="function">ll <span class="title">sum2</span>(<span class="params">ll x</span>)</span> &#123;x %= mod; <span class="keyword">return</span> x % mod \* (<span class="number">1</span> + x) % mod \* (<span class="number">2</span> \* x + <span class="number">1</span>) % mod \* inv6 % mod;&#125;</span><br><span class="line"></span><br><span class="line">map&lt;ll, ll&gt; mp;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Calc</span>(<span class="params">ll x</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; N) <span class="keyword">return</span> sum[x];</span><br><span class="line">    <span class="keyword">if</span>(mp[x]) <span class="keyword">return</span> mp[x];</span><br><span class="line">    ll num = sum1(x);</span><br><span class="line">    <span class="keyword">for</span>(ll l = <span class="number">2</span>, r;l &lt;= x;l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = x / (x / l);</span><br><span class="line">        num = (num - Calc(x / l) % mod \* (sum2(r) - sum2(l - <span class="number">1</span>) + mod) % mod + mod) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mp[x] = num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Ans</span>()</span> &#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll l = <span class="number">1</span>, r;l &lt;= n; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = n / (n / l);</span><br><span class="line">        ans = (ans + sum1(n / l) % mod \* (Calc(r) - Calc(l - <span class="number">1</span>) % mod + mod) % mod) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span>()</span> &#123;</span><br><span class="line">    cin &gt;&gt; mod &gt;&gt; n;</span><br><span class="line">    Get\_phi();</span><br><span class="line">    inv4 = quick\_pow(<span class="number">4</span>, mod - <span class="number">2</span>);</span><br><span class="line">    inv6 = quick\_pow(<span class="number">6</span>, mod - <span class="number">2</span>);</span><br><span class="line">    cout &lt;&lt; Ans() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">signed <span class="title">main</span>()</span> &#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">//cout.tie(nullptr);</span></span><br><span class="line"><span class="meta">##ifdef FZT\_ACM\_LOCAL</span></span><br><span class="line">    freopen(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    freopen(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    signed test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) exit(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        auto start\_clock\_for\_debug = clock();</span><br><span class="line">        solve();</span><br><span class="line">        auto end\_clock\_for\_debug = clock();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.putback(acm\_local\_for\_debug));</span><br><span class="line"><span class="meta">##<span class="keyword">else</span></span></span><br><span class="line">    solve();</span><br><span class="line"><span class="meta">##<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="P3327-SDOI2015-约数个数和"><a href="#P3327-SDOI2015-约数个数和" class="headerlink" title="P3327 [SDOI2015]约数个数和"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3327">P3327 [SDOI2015]约数个数和</a></h4><p>$$求解\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^md (ij)$$</p>
<p>$$\ {约数的重要性质:(ij)&#x3D;\sum_{xi}\sum_{yj}[gcd(x,y )&#x3D;1]}$$</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sun123zxy/p/12295533.html">https://www.cnblogs.com/sun123zxy/p/12295533.html</a></p>
<p>$得：$ $$\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m\sum_{xi}\sum_{yj}[gcd(x,y )&#x3D;1]$$</p>
<p>$改变枚举顺序，枚举x和y:$</p>
<p>$$\sum_{x&#x3D;1}^n\sum_{y&#x3D;1}^m\left \lfloor \frac{n}{x} \right \rfloor\left \lfloor \frac{n}{y} \right \rfloor[gcd(x,y)&#x3D;1]$$</p>
<p>$$\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m\left \lfloor \frac{n}{i} \right \rfloor\left \lfloor \frac{n}{j} \right \rfloor[gcd(i,j)&#x3D;1]$$</p>
<p>$后面套用前面得：$</p>
<p>$$\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m\left \lfloor \frac{n}{i} \right \rfloor\left \lfloor \frac{n}{j} \right \rfloor\sum_{di\;dj}\mu(d)$$</p>
<p>$枚举d得：$</p>
<p>$$\sum_{d&#x3D;1}^{min(n,m)}\mu(d)\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m\left \lfloor \frac{n}{i} \right \rfloor\left \lfloor \frac{n}{j} \right \rfloor[dgcd(i,j)]$$</p>
<p>$由于[dgcd(i,j)]成立的条件为d是gcd(i,j)的约数，所以可以把枚举i,j变换为枚举di,dj，从而[1gcd(i,j)]可以省略。得：$</p>
<p>$$\sum_{d&#x3D;1}^{min(n,m)}\mu(d)\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{d} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor\frac{m}{d}\right \rfloor}\left \lfloor \frac{n}{id} \right \rfloor\left \lfloor \frac{n}{jd} \right \rfloor$$</p>
<p>$$\sum_{d&#x3D;1}^{min(n,m)}\mu(d)\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{d} \right \rfloor}\left \lfloor \frac{n}{id} \right \rfloor\sum_{j&#x3D;1}^{\left \lfloor\frac{m}{d}\right \rfloor}\left \lfloor \frac{n}{jd} \right \rfloor$$</p>
<p>$令\ {f(x)&#x3D;\sum_{i&#x3D;1}^x\left \lfloor \frac{x}{i} \right \rfloor}，则：$</p>
<p>$$\sum_{d&#x3D;1}^{min(n,m)}\mu(d)f(\frac{n}{d})f(\frac{m}{d})$$</p>
<p>$\ {O(n)处理\mu和其前缀和，O(n\sqrt n)处理f，O(\sqrt n)询问分块，总复杂度为O(n\sqrt n+T\sqrt n)}$</p>
<h3 id="Code-5"><a href="#Code-5" class="headerlink" title="Code"></a>Code</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">long</span> ll;</span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">double</span> ld;</span><br><span class="line">typedef pair&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; pdd;</span><br><span class="line"></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> INF 0x7f7f7f</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> FOR(i, x, n) for(int i = x;i &lt;= n; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="comment">// const int maxn = 1e5 + 10;</span></span><br><span class="line"><span class="comment">// const double eps = 1e-6;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">5e4</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">ll mu[N]; <span class="comment">// 莫比乌斯函数</span></span><br><span class="line"><span class="built_in">bool</span> <span class="keyword">is</span>\_prime[N];</span><br><span class="line"><span class="built_in">int</span> prime[N];</span><br><span class="line"><span class="built_in">int</span> cnt;</span><br><span class="line"></span><br><span class="line">ll f[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Mobi</span>() <span class="comment">// 莫比乌斯函数初始化</span></span></span><br><span class="line">&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">is</span>\_prime[<span class="number">0</span>] = <span class="keyword">is</span>\_prime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">2</span>;i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">is</span>\_prime[i]) &#123;</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">            prime[++cnt] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; i \* prime[j] &lt; N; j++) &#123;</span><br><span class="line">            <span class="keyword">is</span>\_prime[i \* prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                mu[i \* prime[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i \* prime[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt; N; i++) &#123;</span><br><span class="line">        mu[i] += mu[i - <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt; N; i++) &#123;</span><br><span class="line">        ll ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> l = <span class="number">1</span>, r;l &lt;= i; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">            r = i / (i / l);</span><br><span class="line">            ans += (r - l + <span class="number">1</span>) \* (i / l);</span><br><span class="line">        &#125;</span><br><span class="line">        f[i] = ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Ans</span>(<span class="params">ll n, ll m</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    ll k = min(n, m);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(ll l = <span class="number">1</span>, r;l &lt;= k; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = min(n / (n / l), m / (m / l));</span><br><span class="line">        ans += (mu[r] - mu[l - <span class="number">1</span>]) \* f[m / l] \* f[n / l];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span>()</span> &#123;</span><br><span class="line">    <span class="built_in">int</span> T;</span><br><span class="line">    Mobi();</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span>(T--) &#123;</span><br><span class="line">        ll n, m;</span><br><span class="line">        cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">        cout &lt;&lt; Ans(n, m) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">signed <span class="title">main</span>()</span> &#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">//cout.tie(nullptr);</span></span><br><span class="line"><span class="meta">##ifdef FZT\_ACM\_LOCAL</span></span><br><span class="line">    freopen(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    freopen(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    signed test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) exit(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        auto start\_clock\_for\_debug = clock();</span><br><span class="line">        solve();</span><br><span class="line">        auto end\_clock\_for\_debug = clock();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.putback(acm\_local\_for\_debug));</span><br><span class="line"><span class="meta">##<span class="keyword">else</span></span></span><br><span class="line">    solve();</span><br><span class="line"><span class="meta">##<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="P3312-SDOI2014-数表"><a href="#P3312-SDOI2014-数表" class="headerlink" title="P3312 [SDOI2014]数表"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3312">P3312 [SDOI2014]数表</a></h4><p>$$求解\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m\sum_{di\;dj}d[\sum_{di\;dj}d\leq a]$$</p>
<p>$令\ {F(x)&#x3D;\sum_{ix}i}，则得：$</p>
<p>$$\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m F(gcd(i,j))[F(gcd(i,j))\leq a]$$</p>
<p>$$\sum_{d&#x3D;1}^{min(n,m)}\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m F(d)[gcd(i,j)&#x3D;d][F(d)\leq a]$$</p>
<p>$$\sum_{d&#x3D;1}^{min(n,m)}F(d)[F(d)\leq a]\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^m[gcd(i,j)&#x3D;d]$$</p>
<p>$后半部分就套用前面得：$</p>
<p>$$\sum_{d&#x3D;1}^{min(n,m)}F(d)[F(d)\leq a]\sum_{d^{‘}&#x3D;1}^{min(\left \lfloor \frac{n}{d} \right \rfloor, \left \lfloor \frac{m}{d} \right \rfloor)}\mu(d^{‘})\left \lfloor \frac{n}{dd^{‘}} \right \rfloor \left \lfloor \frac{m}{dd^{‘}} \right \rfloor$$</p>
<p>$令T替换dd^{‘}得：$</p>
<p>$$\sum_{T&#x3D;1}^{min(n,m)}\sum_{dT}F(d)\mu(\frac{T}{d})\left \lfloor \frac{n}{T} \right \rfloor \left \lfloor \frac{m}{T} \right \rfloor[F(d)\leq a]$$</p>
<p>$$\sum_{T&#x3D;1}^{min(n,m)}\left \lfloor \frac{n}{T} \right \rfloor \left \lfloor \frac{m}{T} \right \rfloor\sum_{dT}F(d)\mu(\frac{T}{d})[F(d)\leq a]$$</p>
<p>$令\ {f(x)&#x3D;\sum_{dx}F(d)\mu(\frac{x}{d})[F(d)\leq a]}得：$</p>
<p>$$\sum_{T&#x3D;1}^{min(n,m)}\left \lfloor \frac{n}{T} \right \rfloor \left \lfloor \frac{m}{T} \right \rfloor f(T)$$</p>
<p>$\ {O(n)处理\mu，O(nlogn)处理F，对于每次询问的a值可以离线排序，树状数组维护f，处理时间为O(nlog^{2}n)，O(\sqrt n\; logn)询问分块，总时间复杂度为O(nlog^2n)+T\sqrt n\; logn}$</p>
<h3 id="Code-6"><a href="#Code-6" class="headerlink" title="Code"></a>Code</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">long</span> ll;</span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">double</span> ld;</span><br><span class="line">typedef pair&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; pdd;</span><br><span class="line"></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> lc u &lt;&lt; 1</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> rc u &lt;&lt; 1  1</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> m (l + r) / 2</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mid (t[u].l + t[u].r) / 2</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> lowbit(x) x &amp; (-x)</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> FOR(i, x, n) for(int i = x;i &lt;= n; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="comment">// const ll mod = 1e9 + 7;</span></span><br><span class="line"><span class="comment">// const double eps = 1e-6;</span></span><br><span class="line"><span class="comment">// const double PI = acos(-1);</span></span><br><span class="line"><span class="comment">// const double R = 0.57721566490153286060651209;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">1e5</span> + <span class="number">1</span>;</span><br><span class="line">ll mod = (<span class="number">1l</span>l \* <span class="number">1</span>) &lt;&lt; <span class="number">31</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> node &#123;</span><br><span class="line">    <span class="built_in">int</span> id;</span><br><span class="line">    ll data;</span><br><span class="line">&#125;F[N];</span><br><span class="line"><span class="keyword">struct</span> Node &#123;</span><br><span class="line">    <span class="built_in">int</span> nn, mm, id;</span><br><span class="line">    ll a;</span><br><span class="line">&#125;q[N];</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> cnt, prime[N];</span><br><span class="line"><span class="built_in">bool</span> <span class="keyword">is</span>\_prime[N];</span><br><span class="line"><span class="built_in">int</span> mu[N];</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> cmp\_F(node a, node b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a.data &lt; b.data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> cmp\_Q(Node a, Node b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a.a &lt; b.a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">inline <span class="keyword">void</span> <span class="title">init</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">is</span>\_prime[<span class="number">0</span>] = <span class="keyword">is</span>\_prime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">2</span>;i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">is</span>\_prime[i]) &#123;</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">            prime[++cnt] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; i \* prime[j] &lt; N; j++) &#123;</span><br><span class="line">            <span class="keyword">is</span>\_prime[i \* prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                mu[i \* prime[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i \* prime[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt; N; i++) &#123;</span><br><span class="line">        F[i].id = i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> j = <span class="number">1</span>;j \* i &lt; N; j++) &#123;</span><br><span class="line">            F[i \* j].data += i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(F + <span class="number">1</span>, F + N, cmp\_F);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll t[N];</span><br><span class="line">ll ans[N];</span><br><span class="line"></span><br><span class="line"><span class="function">inline <span class="keyword">void</span> <span class="title">add</span>(<span class="params"><span class="built_in">int</span> x, <span class="built_in">int</span> v</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span>(x &lt; N) &#123;</span><br><span class="line">        t[x] = (t[x] + v) % mod;</span><br><span class="line">        <span class="keyword">if</span>(t[x] &gt; mod)</span><br><span class="line">            t[x] %= mod;</span><br><span class="line">        x += lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">inline ll <span class="title">query</span>(<span class="params"><span class="built_in">int</span> x</span>)</span> &#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x) &#123;</span><br><span class="line">        ans = (ans + t[x]) % mod;</span><br><span class="line">        <span class="keyword">if</span>(ans &gt; mod)</span><br><span class="line">            ans %= mod;</span><br><span class="line">        x -= lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">inline ll <span class="title">Calc</span>(<span class="params"><span class="built_in">int</span> nn, <span class="built_in">int</span> mm</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(nn &gt; mm)</span><br><span class="line">        swap(nn, mm);</span><br><span class="line"></span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> l = <span class="number">1</span>, r;l &lt;= nn; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = min(nn / (nn / l), mm / (mm / l));</span><br><span class="line">        ans = (ans + <span class="number">1l</span>l \* (nn / l) \* (mm / l) % mod \* (query(r) - query(l - <span class="number">1</span>)) % mod) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//struct SegMent &#123;</span></span><br><span class="line"><span class="comment">//    int l, r;</span></span><br><span class="line"><span class="comment">//    int sum;</span></span><br><span class="line"><span class="comment">//&#125;t[N &lt;&lt; 2];</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//void push\_up(int u) &#123;</span></span><br><span class="line"><span class="comment">//    t[u].sum = t[lc].sum + t[rc].sum;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//void build(int u, int l, int r) &#123;</span></span><br><span class="line"><span class="comment">//    t[u].l = l;</span></span><br><span class="line"><span class="comment">//    t[u].r = r;</span></span><br><span class="line"><span class="comment">//    if(l == r) &#123;</span></span><br><span class="line"><span class="comment">//        t[u].sum = a[l];</span></span><br><span class="line"><span class="comment">//        return ;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    build(lc, l, m);</span></span><br><span class="line"><span class="comment">//    build(rc, m + 1, r);</span></span><br><span class="line"><span class="comment">//    push\_up(u);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//void update(int u, int p, int v) &#123;</span></span><br><span class="line"><span class="comment">//    if(t[u].l == t[u].r) &#123;</span></span><br><span class="line"><span class="comment">//        t[u].sum += v;</span></span><br><span class="line"><span class="comment">//        return ;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    if(p &lt;= mid) update(lc, p, v);</span></span><br><span class="line"><span class="comment">//    else update(rc, p, v);</span></span><br><span class="line"><span class="comment">//    push\_up(u);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//int query(int u, int ql, int qr) &#123;</span></span><br><span class="line"><span class="comment">//    if(ql &lt;= t[u].l &amp;&amp; t[u].r &lt;= qr) &#123;</span></span><br><span class="line"><span class="comment">//        return t[u].sum;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    int ans = 0;</span></span><br><span class="line"><span class="comment">//    if(ql &lt;= mid)</span></span><br><span class="line"><span class="comment">//        ans += query(lc, ql, qr);</span></span><br><span class="line"><span class="comment">//    if(qr &gt; mid)</span></span><br><span class="line"><span class="comment">//        ans += query(rc, ql, qr);</span></span><br><span class="line"><span class="comment">//    return ans;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span>()</span> &#123;</span><br><span class="line">    <span class="keyword">init</span>();</span><br><span class="line">    <span class="built_in">int</span> T;</span><br><span class="line">    scanf(<span class="string">&quot;%d&quot;</span>,&amp;T);</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt;= T; i++) &#123;</span><br><span class="line">        scanf(<span class="string">&quot;%d%d%lld&quot;</span>,&amp;q[i].nn,&amp;q[i].mm, &amp;q[i].a);</span><br><span class="line">        q[i].id = i;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(q + <span class="number">1</span>, q + T + <span class="number">1</span>, cmp\_Q);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">int</span> now = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt;= T; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span>(now &lt; N &amp;&amp; F[now].data &lt;= q[i].a) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="built_in">int</span> j = <span class="number">1</span>;j \* F[now].id &lt; N; j++) &#123;</span><br><span class="line">                <span class="keyword">add</span>(j \* F[now].id, mu[j] \* F[now].data);</span><br><span class="line">            &#125;</span><br><span class="line">            now++;</span><br><span class="line">        &#125;</span><br><span class="line">        ans[q[i].id] = (Calc(q[i].nn, q[i].mm) % mod + mod) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt;= T; i++) &#123;</span><br><span class="line">        printf(<span class="string">&quot;%lld\n&quot;</span>,ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">signed <span class="title">main</span>()</span> &#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">//cout.tie(nullptr);</span></span><br><span class="line"><span class="meta">##ifdef FZT\_ACM\_LOCAL</span></span><br><span class="line">    freopen(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    freopen(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    signed test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) exit(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        auto start\_clock\_for\_debug = clock();</span><br><span class="line">        solve();</span><br><span class="line">        auto end\_clock\_for\_debug = clock();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.putback(acm\_local\_for\_debug));</span><br><span class="line"><span class="meta">##<span class="keyword">else</span></span></span><br><span class="line">    solve();</span><br><span class="line"><span class="meta">##<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="P3172-CQOI2015-选数"><a href="#P3172-CQOI2015-选数" class="headerlink" title="P3172 [CQOI2015]选数"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3172">P3172 [CQOI2015]选数</a></h4><p>$$求解\sum_{i&#x3D;L}^H\sum_{j&#x3D;L}^H…\sum_{x&#x3D;L}^H[gcd(i,j…x)&#x3D;k]$$</p>
<p>$本题求n个数的gcd为k的个数，根据上面套路，将H&#x2F;k,L&#x2F;k，这样就只用求n个数的gcd为1的个数了，注意：如果L整除k，则L&#x3D;L&#x2F;k，否则L&#x3D;L&#x2F;k+1，就是向上取整，那么有一种办法非常好，就让\ {L&#x2F;k+(\frac{k-1}{k})}，即：$</p>
<p>$$\sum_{i&#x3D;{\left \lfloor \frac{L-1}{k} \right \rfloor+1}}^{\left \lfloor \frac{H}{k}\right \rfloor}\sum_{j&#x3D;{\left \lfloor \frac{L-1}{k} \right \rfloor+1}}^{\left \lfloor \frac{H}{k}\right \rfloor}…\sum_{x&#x3D;{\left \lfloor \frac{L-1}{k} \right \rfloor+1}}^{\left \lfloor \frac{H}{k}\right \rfloor}[gcd(i,j…x)&#x3D;1]$$</p>
<p>$$\sum_{i&#x3D;{\left \lfloor \frac{L-1}{k} \right \rfloor+1}}^{\left \lfloor \frac{H}{k}\right \rfloor}\sum_{j&#x3D;{\left \lfloor \frac{L-1}{k} \right \rfloor+1}}^{\left \lfloor \frac{H}{k}\right \rfloor}…\sum_{x&#x3D;{\left \lfloor \frac{L-1}{k} \right \rfloor+1}}^{\left \lfloor \frac{H}{k}\right \rfloor}\sum_{di\;dj\;..\;dx}\mu(d)$$</p>
<p>$枚举d，令\ {l&#x3D;\left \lfloor \frac{L-1}{k} \right \rfloor+1,r&#x3D;\left \lfloor \frac{H}{k}\right \rfloor}：$</p>
<p>$$\sum_{d&#x3D;1}^r\mu(d)\sum_{i&#x3D;l}^r[di]\sum_{j&#x3D;l}^r[dj]…\sum_{x&#x3D;l}^r[dx]$$</p>
<p>$只有当i，j…x都是d的倍数的时候，最终答案+1，根据容斥原理，那么在[l,r]中d倍数有\ {\frac{r}{d}-\frac{l-1}{d}}，对于所有的i，j…x，他们当中所有[l,r]的d的倍数的个数有\ {(\frac{r}{d}-\frac{l-1}{d})^n}，即为：$</p>
<p>$$\sum_{d&#x3D;1}^{r}\mu(d)*(\frac{r}{d}-\frac{l-1}{d})^n$$</p>
<p>$这里的H非常大，如果用线性筛去处理\mu，会直接Wa掉，因为没法处理到10^9次方那么大的前缀和，数组也开不了那么大。后果：$</p>
<p><img src="https://img-blog.csdnimg.cn/20200815153844583.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2Z6dHNpbGx5,size_16,color_FFFFFF,t_70##pic_center" alt="在这里插入图片描述"> $这里的AC可能就是一小部分的运气罢了。如果用线性筛，RE的RE，WA的WA，所以推荐用杜教筛取筛。$</p>
<p>$\ {设f(d)&#x3D;\mu(d),S(r)&#x3D;\sum_{d&#x3D;1}^nf(d)，这里的S就是要求的前缀和。}$ $我们选择\ {g&#x3D;I},则\sum_{i&#x3D;1}^r(f*g)i&#x3D;\sum_{i&#x3D;1}^r(\mu*I)i&#x3D;\sum_{i&#x3D;1}^r\varepsilon (i)&#x3D;1。$</p>
<p>$枚举y：$</p>
<p>$$\sum_{y&#x3D;1}^rg(y)\sum_{x&#x3D;1}^{\left \lfloor \frac{r}{y} \right \rfloor)}f(x)$$</p>
<p>$$\sum_{y&#x3D;1}^rg(y)S(\left \lfloor \frac{r}{y} \right \rfloor)$$</p>
<p>$$\sum_{i&#x3D;1}^r(f*g)i &#x3D;g(1)S(r)+\sum_{y&#x3D;2}^rg(y)S(\left \lfloor \frac{r}{y} \right \rfloor)$$</p>
<p>$$S(r)&#x3D;\frac{\sum_{i&#x3D;1}^r(f*g)i-\sum_{y&#x3D;2}^rg(y)S(\left \lfloor \frac{r}{y} \right \rfloor)}{g(1)}$$</p>
<p>$当g&#x3D;I时，即：$</p>
<p>$$\ {S(r)&#x3D;1-\sum_{y&#x3D;2}^rS(\left \lfloor \frac{r}{y} \right \rfloor)}$$</p>
<p>$\ {杜教筛的复杂度为O(n\frac{2}{3})，比线性筛还要快一点，总时间复杂度为O(n^{\frac{2}{3}})。}$</p>
<h3 id="Code-7"><a href="#Code-7" class="headerlink" title="Code"></a>Code</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">long</span> ll;</span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">double</span> ld;</span><br><span class="line">typedef pair&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; pdd;</span><br><span class="line"></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> INF 0x7f7f7f</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> FOR(i, x, n) for(int i = x;i &lt;= n; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="comment">// const int maxn = 1e5 + 10;</span></span><br><span class="line"><span class="comment">// const double eps = 1e-6;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ll mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> mu[N]; <span class="comment">// 莫比乌斯函数</span></span><br><span class="line"><span class="built_in">bool</span> <span class="keyword">is</span>\_prime[N];</span><br><span class="line"><span class="built_in">int</span> prime[N];</span><br><span class="line"><span class="built_in">int</span> cnt;</span><br><span class="line">ll sum[N];</span><br><span class="line"></span><br><span class="line">ll n, L, H, k;</span><br><span class="line"></span><br><span class="line">ll quick\_pow(ll a, ll b) &#123;</span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b &amp; <span class="number">1</span>) ans = ans \* a % mod;</span><br><span class="line">        a = a \* a % mod;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Mobi</span>() <span class="comment">// 莫比乌斯函数初始化</span></span></span><br><span class="line">&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">is</span>\_prime[<span class="number">0</span>] = <span class="keyword">is</span>\_prime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">2</span>;i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">is</span>\_prime[i]) &#123;</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">            prime[++cnt] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; i \* prime[j] &lt; N; j++) &#123;</span><br><span class="line">            <span class="keyword">is</span>\_prime[i \* prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                mu[i \* prime[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i \* prime[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt; N; i++) &#123;</span><br><span class="line">        sum[i] = (sum[i - <span class="number">1</span>] + mu[i]) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">map&lt;ll , ll&gt; mp;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Calc</span>(<span class="params">ll x</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; N)</span><br><span class="line">        <span class="keyword">return</span> sum[x];</span><br><span class="line">    <span class="keyword">if</span>(mp[x])</span><br><span class="line">        <span class="keyword">return</span> mp[x];</span><br><span class="line">    ll num = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> l = <span class="number">2</span>, r;l &lt;= x; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = x / (x / l);</span><br><span class="line">        num = (num - Calc(x / l) \* (r - l + <span class="number">1</span>) % mod + mod) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mp[x] = num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Ans</span>()</span> &#123;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(ll l = <span class="number">1</span>, r;l &lt;= H;l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = min(H / (H / l), (L / l) ? L / (L / l) : H + <span class="number">2</span>);</span><br><span class="line">        ans = (ans + (Calc(r) - Calc(l - <span class="number">1</span>) + mod) % mod \* quick\_pow((H / l) - (L / l), n) % mod + mod) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (ans + mod) % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span>()</span> &#123;</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; k &gt;&gt; L &gt;&gt; H;</span><br><span class="line">    L = (L - <span class="number">1</span>) / k; <span class="comment">// 因为后面需要L-1，所以这里干脆就不+1了，但是含义不同</span></span><br><span class="line">    H = H / k;</span><br><span class="line">    Mobi();</span><br><span class="line">    cout &lt;&lt; Ans() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">signed <span class="title">main</span>()</span> &#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">//cout.tie(nullptr);</span></span><br><span class="line"><span class="meta">##ifdef FZT\_ACM\_LOCAL</span></span><br><span class="line">    freopen(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    freopen(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    signed test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) exit(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        auto start\_clock\_for\_debug = clock();</span><br><span class="line">        solve();</span><br><span class="line">        auto end\_clock\_for\_debug = clock();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.putback(acm\_local\_for\_debug));</span><br><span class="line"><span class="meta">##<span class="keyword">else</span></span></span><br><span class="line">    solve();</span><br><span class="line"><span class="meta">##<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="AT5200-AGC038C-LCMs"><a href="#AT5200-AGC038C-LCMs" class="headerlink" title="AT5200 [AGC038C] LCMs"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/AT5200">AT5200 [AGC038C] LCMs</a></h4><p>$$求解\sum_{i&#x3D;1}^{N}\sum_{j&#x3D;1}^Nlcm(A_i,A_j)$$</p>
<p>$莫比乌斯反演处理的一般都是枚举变量之间的关系，所以我们要让A_i和A_j变为i和j的形式。$</p>
<p>$想要用i和j表示A_i和A_j并且不遗漏任何的A，所以让A等于某个i，就是让cnt_i&#x3D;\ {\sum_{d&#x3D;1}^N[A_d&#x3D;i]}，统计所有A等于某个i的个数，即cnt_i，j也同样如此，如下所示：$</p>
<p>$$\sum_{i&#x3D;1}^{N}\sum_{j&#x3D;1}^Ncnt_icnt_jlcm(i,j)$$</p>
<p>$这样还不够，因为i只能是[1,N]的，当Ai中有些值大于N的话，再枚举i从[1,N]就会漏掉大于N的Ai的情况，所以想要统计所有情况，即让N&#x3D;Ai中最大的数即可，即\ {M&#x3D;\max_{i&#x3D;1}^N }。$ $所以我们需要反演的式子为：$</p>
<p>$$\sum_{i&#x3D;1}^{M}\sum_{j&#x3D;1}^Mcnt_i ⋅cnt_j ⋅lcm(i,j)$$</p>
<p>$$\sum_{i&#x3D;1}^{M}\sum_{j&#x3D;1}^Mcnt_i ⋅cnt_j ⋅\frac{ij}{gcd(i,j)}$$</p>
<p>$$\sum_{k&#x3D;1}^M\sum_{i&#x3D;1}^{M}\sum_{j&#x3D;1}^Mcnt_i ⋅cnt_j ⋅\frac{ij}{k[gcd(i,j)&#x3D;k]}$$</p>
<p>$$\sum_{k&#x3D;1}^M\sum_{i&#x3D;1}^{\left \lfloor \frac{M}{k} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor \frac{M}{k} \right \rfloor}cnt_{ik} ⋅cnt_{jk} ⋅\frac{ijk^2}{k}[gcd(i,j)&#x3D;1]$$</p>
<p>$$\sum_{k&#x3D;1}^Mk\sum_{i&#x3D;1}^{\left \lfloor \frac{M}{k} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor \frac{M}{k} \right \rfloor}cnt_{ik} ⋅cnt_{jk} ⋅i ⋅j\sum_{di\;dj}\mu(d)$$</p>
<p>$$\sum_{k&#x3D;1}^Mk\sum_{d&#x3D;1}^{\left \lfloor \frac{M}{k} \right \rfloor}\mu(d)\sum_{i&#x3D;1}^{\left \lfloor \frac{M}{kd} \right \rfloor}cnt_{ikd} ⋅id\sum_{j&#x3D;1}^{\left \lfloor \frac{M}{kd} \right \rfloor}cnt_{jkd} ⋅jd$$</p>
<p>$$\sum_{k&#x3D;1}^Mk\sum_{d&#x3D;1}^{\left \lfloor \frac{M}{k} \right \rfloor}\mu(d)d^2(\sum_{i&#x3D;1}^{\left \lfloor \frac{M}{kd} \right \rfloor}cnt_{ikd} ⋅i)^2$$</p>
<p>$令T&#x3D;kd则：$</p>
<p>$$\sum_{T&#x3D;1}^M(\sum_{i&#x3D;1}^{\left \lfloor \frac{M}{T} \right \rfloor}cnt_{iT} ⋅i)^2\sum_{kT}\mu(k)k^2\frac{T}{k}$$</p>
<p>$$\sum_{T&#x3D;1}^MT(\sum_{i&#x3D;1}^{\left \lfloor \frac{M}{T} \right \rfloor}cnt_{iT} ⋅i)^2\sum_{kT}\mu(k)k$$</p>
<p>$令\ {f(x)&#x3D;\sum_{ix}\mu(i)i\;,\;g(x)&#x3D;\sum_{i&#x3D;1}^{\left \lfloor \frac{M}{x} \right \rfloor}cnt_{ix} ⋅i&#x3D;\frac{1}{x}\sum_{xt}tcnt_t},则最后的式子为：$</p>
<p>$$\sum_{T&#x3D;1}^MTg^2(T)f(T)$$</p>
<p>$\ {O(n)处理A的次数，O(nlogn)处理f和g，总时间复杂度为O(nlogn)}$</p>
<h3 id="Code-8"><a href="#Code-8" class="headerlink" title="Code"></a>Code</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">long</span> ll;</span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">double</span> ld;</span><br><span class="line">typedef pair&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; pdd;</span><br><span class="line"></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> INF 0x7f7f7f</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> FOR(i, x, n) for(int i = x;i &lt;= n; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="comment">// const int maxn = 1e5 + 10;</span></span><br><span class="line"><span class="comment">// const double eps = 1e-6;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> mu[N]; <span class="comment">// 莫比乌斯函数</span></span><br><span class="line"><span class="built_in">bool</span> <span class="keyword">is</span>\_prime[N];</span><br><span class="line"><span class="built_in">int</span> prime[N];</span><br><span class="line"><span class="built_in">int</span> tot;</span><br><span class="line">ll f[N], g[N];</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> M, n;</span><br><span class="line"><span class="built_in">int</span> cnt[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Mobi</span>() <span class="comment">// 莫比乌斯函数初始化</span></span></span><br><span class="line">&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">is</span>\_prime[<span class="number">0</span>] = <span class="keyword">is</span>\_prime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">2</span>;i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">is</span>\_prime[i]) &#123;</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">            prime[++tot] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">1</span>; j &lt;= tot &amp;&amp; i \* prime[j] &lt; N; j++) &#123;</span><br><span class="line">            <span class="keyword">is</span>\_prime[i \* prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                mu[i \* prime[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i \* prime[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt;= M; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> x = i;x &lt;= M; x += i) &#123;</span><br><span class="line">            f[x] += mu[i] \* i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> x = <span class="number">1</span>;x &lt;= M; x++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> t = x;t &lt;= M; t += x) &#123;</span><br><span class="line">            g[x] += t \* cnt[t];</span><br><span class="line">        &#125;</span><br><span class="line">        g[x] /= x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span>()</span> &#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    M = n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="built_in">int</span> x;</span><br><span class="line">        cin &gt;&gt; x;</span><br><span class="line">        cnt[x]++;</span><br><span class="line">        M = max(M, x);</span><br><span class="line">    &#125;</span><br><span class="line">    Mobi();</span><br><span class="line"></span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt;= M; i++) &#123;</span><br><span class="line">        ans += i \* g[i] \* g[i] \* f[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">signed <span class="title">main</span>()</span> &#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">//cout.tie(nullptr);</span></span><br><span class="line"><span class="meta">##ifdef FZT\_ACM\_LOCAL</span></span><br><span class="line">    freopen(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    freopen(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    signed test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) exit(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        auto start\_clock\_for\_debug = clock();</span><br><span class="line">        solve();</span><br><span class="line">        auto end\_clock\_for\_debug = clock();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.putback(acm\_local\_for\_debug));</span><br><span class="line"><span class="meta">##<span class="keyword">else</span></span></span><br><span class="line">    solve();</span><br><span class="line"><span class="meta">##<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SP5971-LCMSUM-LCM-Sum"><a href="#SP5971-LCMSUM-LCM-Sum" class="headerlink" title="SP5971 LCMSUM - LCM Sum"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/SP5971">SP5971 LCMSUM - LCM Sum</a></h4><p>$$求解\sum_{i&#x3D;1}^nlcm(i,n)$$</p>
<p>$\left \lfloor \frac{n}{k} \right \rfloor$</p>
<p>$$\sum_{i&#x3D;1}^n\frac{in}{gcd(i,n)}$$</p>
<p>$$\sum_{k&#x3D;1}^n\sum_{i&#x3D;1}^n\frac{in}{k[gcd(i,n)&#x3D;k]}$$</p>
<p>$$\sum_{k&#x3D;1}^n\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}in[gcd(i,\frac{n}{k})&#x3D;1]$$</p>
<p>$$n\sum_{k&#x3D;1}^n\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}i[gcd(i,\frac{n}{k})&#x3D;1]$$</p>
<p>$$n\sum_{kn}\sum_{i&#x3D;1}^ki[gcd(i,k)&#x3D;1]$$</p>
<p>$$n\sum_{kn}\sum_{i&#x3D;1}^ki\sum_{di\;dk}\mu(d)$$</p>
<p>$枚举d：$</p>
<p>$$n\sum_{kn}\sum_{dk}\mu(d)\sum_{i&#x3D;1}^{\left \lfloor \frac{k}{d} \right \rfloor}id$$</p>
<p>$$n\sum_{kn}\sum_{dk}\mu(d)d\sum_{i&#x3D;1}^{\left \lfloor \frac{k}{d} \right \rfloor}i$$</p>
<p>$$n\sum_{kn}\sum_{dk}\mu(d)d\frac{\left \lfloor \frac{k}{d} \right \rfloor*(\left \lfloor \frac{k}{d} \right \rfloor+1)}{2}$$</p>
<p>$$\frac{n}{2}\sum_{kn}{\sum_{dk}\mu(d)*\frac{k^2}{d}+\sum_{dk}\mu(d)*k}$$</p>
<p>$$\frac{n}{2}\sum_{kn}k{\sum_{dk}\mu(d)*\frac{k}{d}+\sum_{dk}\mu(d)}$$</p>
<p>$\ {这时候发现两个狄利克雷卷积，\varphi (n)&#x3D;\mu*id&#x3D;\sum_{dn}\mu(d)*\frac{n}{d}\;\;,\;\;\varepsilon(n) &#x3D;\mu*I&#x3D;\sum_{dn}\mu(d)。所以我们将其替换得：}$</p>
<p>$$\frac{n}{2}\sum_{kn}k[\varphi(k)+\varepsilon(k)]$$</p>
<p>$\ {O(n)处理\varphi，\sqrt n询问答案，总复杂度为O(n+T\sqrt n)。}$</p>
<h3 id="Code-9"><a href="#Code-9" class="headerlink" title="Code"></a>Code</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">long</span> ll;</span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">double</span> ld;</span><br><span class="line">typedef pair&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; pdd;</span><br><span class="line"></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> INF 0x7f7f7f</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> FOR(i, x, n) for(int i = x;i &lt;= n; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="comment">// const int maxn = 1e5 + 10;</span></span><br><span class="line"><span class="comment">// const double eps = 1e-6;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> phi[N];</span><br><span class="line"><span class="built_in">bool</span> <span class="keyword">is</span>\_prime[N];</span><br><span class="line"><span class="built_in">int</span> prime[N];</span><br><span class="line"><span class="built_in">int</span> tot;</span><br><span class="line"></span><br><span class="line">ll f[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Euler</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">is</span>\_prime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">2</span>;i &lt; N; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">is</span>\_prime[i]) &#123;</span><br><span class="line">            phi[i] = i - <span class="number">1</span>;</span><br><span class="line">            prime[++tot] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> j = <span class="number">1</span>;j &lt;= tot &amp;&amp; i \* prime[j] &lt; N; j++)&#123;</span><br><span class="line">            <span class="keyword">is</span>\_prime[i \* prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(i % prime[j]) &#123;</span><br><span class="line">                phi[i \* prime[j]] = phi[i] \* (prime[j] - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                phi[i \* prime[j]] = phi[i] \* prime[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> j = i;j &lt; N; j += i) &#123;</span><br><span class="line">            f[j]  += <span class="number">1l</span>l \* phi[i] \* i + (i == <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span>()</span> &#123;</span><br><span class="line">    Euler();</span><br><span class="line">    <span class="built_in">int</span> T;</span><br><span class="line">    cin &gt;&gt; T;</span><br><span class="line">    <span class="keyword">while</span>(T--) &#123;</span><br><span class="line">        <span class="built_in">int</span> n;</span><br><span class="line">        cin &gt;&gt; n;</span><br><span class="line">        cout &lt;&lt; f[n] \* n / <span class="number">2</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">signed <span class="title">main</span>()</span> &#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">//cout.tie(nullptr);</span></span><br><span class="line"><span class="meta">##ifdef FZT\_ACM\_LOCAL</span></span><br><span class="line">    freopen(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    freopen(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    signed test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) exit(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        auto start\_clock\_for\_debug = clock();</span><br><span class="line">        solve();</span><br><span class="line">        auto end\_clock\_for\_debug = clock();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.putback(acm\_local\_for\_debug));</span><br><span class="line"><span class="meta">##<span class="keyword">else</span></span></span><br><span class="line">    solve();</span><br><span class="line"><span class="meta">##<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="P5221-Product"><a href="#P5221-Product" class="headerlink" title="P5221 Product"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5221">P5221 Product</a></h4><p>$$求解\prod_{i&#x3D;1}^n\prod_{j&#x3D;1}^n\frac{lcm(i,j)}{gcd(i,j)}$$</p>
<p>$首先还是把lcm(i,j)化简得：$</p>
<p>$$\prod_{i&#x3D;1}^n\prod_{j&#x3D;1}^n\frac{ij}{[gcd(i,j)]^2}$$</p>
<p>$$\prod_{i&#x3D;1}^n\prod_{j&#x3D;1}^nij*\prod_{i&#x3D;1}^n\prod_{j&#x3D;1}^n\frac{1}{[gcd(i,j)]^2}$$</p>
<p>$\ {我们很容易推出前半部分的数值为(n!)^{2n }，后半部分的值就是\prod_{i&#x3D;1}^n\prod_{j&#x3D;1}^n[gcd(i,j)]^2的逆元的平方。}$</p>
<p>$所以现在求解：$</p>
<p>$$\prod_{i&#x3D;1}^n\prod_{j&#x3D;1}^ngcd(i,j)$$</p>
<p>$$\prod_{k&#x3D;1}^n\prod_{i&#x3D;1}^n\prod_{j&#x3D;1}^nk[gcd(i,j)&#x3D;k]$$</p>
<p>$$\prod_{k&#x3D;1}^nk^{\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^n[gcd(i,j)&#x3D;k]}$$</p>
<p>$这个式子的变换，本来是[1,n]中所有的gcd累乘，然后我们单独把gcd(i,j)&#x3D;k的拿出来，k会有[1,n]的范围，然后我们再将这些k累乘就会达到之前的效果。$ $不过，[1,n]中的gcd不单单只有一个，可能会有多个相同的gcd，所以变换之后的式子里还需要统计gcd&#x3D;k出现的次数，那只需要将他们累加即可。$</p>
<p>$所以没毛病。继续：$</p>
<p>$$\prod_{k&#x3D;1}^nk^{\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}[gcd(i,j)&#x3D;1]}$$</p>
<p>$$\prod_{k&#x3D;1}^nk^{\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\sum_{di\;dj}\mu(d)}$$</p>
<p>$枚举d：$</p>
<p>$$\prod_{k&#x3D;1}^nk^{\sum_{d&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\mu(d)\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{kd} \right \rfloor}\sum_{j&#x3D;1}^{\left \lfloor \frac{n}{kd} \right \rfloor}1}$$</p>
<p>$$\ {\prod_{k&#x3D;1}^nk^{\sum_{d&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\mu(d)(\left \lfloor \frac{n}{kd} \right \rfloor)^2}}$$</p>
<p>$最终答案为：$</p>
<p>$$\ {(n!)^{2n}\prod_{k&#x3D;1}^nk^{\sum_{d&#x3D;1}^{\left \lfloor \frac{n}{k} \right \rfloor}\mu(d)(\left \lfloor \frac{n}{kd} \right \rfloor)^2}}$$</p>
<p>$\ {O(n)处理\mu的前缀和,\sqrt n询问指数的分块，可以用欧拉降幂优化，总时间复杂度为O(n+nlog_2n}$</p>
<h3 id="Code-10"><a href="#Code-10" class="headerlink" title="Code"></a>Code</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">##include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">long</span> ll;</span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">double</span> ld;</span><br><span class="line">typedef pair&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; pdd;</span><br><span class="line"></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> INF 0x7f7f7f</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> FOR(i, x, n) for(int i = x;i &lt;= n; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="comment">// const ll P = 1e9 + 7;</span></span><br><span class="line"><span class="comment">// const int maxn = 1e5 + 10;</span></span><br><span class="line"><span class="comment">// const double eps = 1e-6;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">1000010</span>;</span><br><span class="line"><span class="keyword">const</span> ll mod = <span class="number">104857601</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> <span class="keyword">is</span>\_prime[N];</span><br><span class="line"><span class="built_in">int</span> prime[N];</span><br><span class="line"><span class="built_in">int</span> mu[N]; <span class="comment">// 莫比乌斯函数</span></span><br><span class="line"><span class="built_in">int</span> cnt;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> n;</span><br><span class="line">ll fac = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">ll quick\_pow(ll a, ll b)</span><br><span class="line">&#123;</span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b &amp; <span class="number">1</span>) ans = ans \* a % mod;</span><br><span class="line">        a = a \* a % mod;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Mobi</span>() <span class="comment">// 莫比乌斯函数初始化</span></span></span><br><span class="line">&#123;</span><br><span class="line">    mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">is</span>\_prime[<span class="number">0</span>] = <span class="keyword">is</span>\_prime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">2</span>;i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">is</span>\_prime[i]) &#123;</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">            prime[++cnt] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; i \* prime[j] &lt;= n; j++) &#123;</span><br><span class="line">            <span class="keyword">is</span>\_prime[i \* prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                mu[i \* prime[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i \* prime[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">        mu[i] = mu[i - <span class="number">1</span>] + mu[i];</span><br><span class="line">        fac = fac \* i % mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">Ans</span>()</span> &#123;</span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> k = <span class="number">1</span>;k &lt;= n; k++) &#123;</span><br><span class="line">        ll p = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">int</span> t = n / k;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> l = <span class="number">1</span>, r;l &lt;= t; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">            r = min(t, t / (t / l));</span><br><span class="line">            p = (p + (mu[r] - mu[l - <span class="number">1</span>] + mod - <span class="number">1</span>) \* (t / l) % (mod - <span class="number">1</span>) \* (t / l) % (mod - <span class="number">1</span>)) % (mod - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ans = ans \* quick\_pow(k, p) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    ll k = quick\_pow(ans, mod - <span class="number">2</span>);</span><br><span class="line">    fac = quick\_pow(fac, n);</span><br><span class="line">    <span class="keyword">return</span> quick\_pow(k, <span class="number">2</span>) \* fac % mod \* fac % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span>()</span> &#123;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    Mobi();</span><br><span class="line">    cout &lt;&lt; Ans() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">signed <span class="title">main</span>()</span> &#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">//cout.tie(nullptr);</span></span><br><span class="line"><span class="meta">##ifdef FZT\_ACM\_LOCAL</span></span><br><span class="line">    freopen(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    freopen(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    signed test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) exit(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        auto start\_clock\_for\_debug = clock();</span><br><span class="line">        solve();</span><br><span class="line">        auto end\_clock\_for\_debug = clock();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.putback(acm\_local\_for\_debug));</span><br><span class="line"><span class="meta">##<span class="keyword">else</span></span></span><br><span class="line">    solve();</span><br><span class="line"><span class="meta">##<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="HDU-6588-Function"><a href="#HDU-6588-Function" class="headerlink" title="HDU 6588 Function"></a><a target="_blank" rel="noopener" href="http://acm.hdu.edu.cn/showproblem.php?pid=6588">HDU 6588 Function</a></h4><p>$$求解\sum_{i&#x3D;1}^ngcd(\left \lfloor \sqrt[3]i \right \rfloor,i)$$</p>
<p>$我们先将这个一重和式转化为二重和式，得：$</p>
<p>$$\sum_{a&#x3D;1}^{\left \lfloor \sqrt[3]n \right \rfloor}\sum_{i&#x3D;1}^ngcd(a,i)[\left \lfloor \sqrt[3]i \right \rfloor&#x3D;a]$$</p>
<p>$我们来看这个式子，只有当\left \lfloor \sqrt[3]i \right \rfloor&#x3D;a时，才会有对答案的贡献为gcd(a,i)，所以\ {a \leq \left \lfloor \sqrt[3]i \right \rfloor &lt; a+1，a^3 \leq i \leq (a+1)^3-1}，所以上式转化为：$</p>
<p>$$\ {\sum_{a&#x3D;1}^{\left \lfloor \sqrt[3]n \right \rfloor}\sum_{i&#x3D;a^3}^{min(n,(a+1)^3-1)}gcd(a,i)}$$</p>
<p>$然后我们将这个二重和式拆开得：$</p>
<p>$${\color{Brown}\sum_{a&#x3D;1}^{\left \lfloor \sqrt[3]n \right \rfloor-1}\sum_{i&#x3D;a^3}^{min(n,(a+1)^3-1)}gcd(a,i)+\sum_{i&#x3D;(\left \lfloor \sqrt[3]n \right \rfloor)^3}^ngcd(\left \lfloor \sqrt[3]n \right \rfloor, i)}$$</p>
<p>$令\sqrt[3]n&#x3D;N，并使a&#x3D;i,i&#x3D;j（好看一点）得：$</p>
<p>$${\color{Brown}\sum_{i&#x3D;1}^{N-1}\sum_{j&#x3D;i^3}^{(i+1)^3-1}gcd(i,j)+\sum_{j&#x3D;N^3}^ngcd(N, j)}$$</p>
<p>$先计算前半部分：$</p>
<p>$——————————–$</p>
<h4 id="HDU-6833-A-Very-Easy-Math-Problem"><a href="#HDU-6833-A-Very-Easy-Math-Problem" class="headerlink" title="HDU 6833 A Very Easy Math Problem"></a><a target="_blank" rel="noopener" href="http://acm.hdu.edu.cn/showproblem.php?pid=6833">HDU 6833 A Very Easy Math Problem</a></h4><p>$$求解\sum_{a_1&#x3D;1}^n\sum_{a_2&#x3D;1}^n…\sum_{a_x&#x3D;1}^n\left(\prod_{j&#x3D;1}^xa_j^k\right)f(gcd(a_1,a_2…a_x))gcd(a_1,a_2…a_x)$$ $令d&#x3D;gcd(a_1,a_2…a_x)得：$</p>
<p>$$\sum_{a_1&#x3D;1}^n\sum_{a_2&#x3D;1}^n…\sum_{a_x&#x3D;1}^n\left(\prod_{j&#x3D;1}^xa_j^k\right)f(d)d$$</p>
<p>$枚举d得：$</p>
<p>$$\sum_{d&#x3D;1}^ndf(d)\sum_{a_1&#x3D;1}^n\sum_{a_2&#x3D;1}^n…\sum_{a_x&#x3D;1}^n\left(\prod_{j&#x3D;1}^xa_j^k\right)[gcd(a_1,a_2…a_x)&#x3D;d]$$</p>
<p>$$\sum_{d&#x3D;1}^nd^{kx+1}f(d)\sum_{a_1&#x3D;1}^{\left \lfloor \frac{n}{d} \right \rfloor }\sum_{a_2&#x3D;1}^{\left \lfloor \frac{n}{d} \right \rfloor }…\sum_{a_x&#x3D;1}^{\left \lfloor \frac{n}{d} \right \rfloor }\left(\prod_{j&#x3D;1}^xa_j^k\right)[gcd(a_1,a_2…a_x)&#x3D;1]$$</p>
<p>$$\sum_{d&#x3D;1}^nd^{kx+1}f(d)\sum_{a_1&#x3D;1}^{\left \lfloor \frac{n}{d} \right \rfloor }\sum_{a_2&#x3D;1}^{\left \lfloor \frac{n}{d} \right \rfloor }…\sum_{a_x&#x3D;1}^{\left \lfloor \frac{n}{d} \right \rfloor }\left(\prod_{j&#x3D;1}^xa_j^k\right)\sum_{ta_1\;ta2\;…\;ta_x}\mu(t)$$</p>
<p>$$\sum_{d&#x3D;1}^nd^{kx+1}f(d)\left (\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{d} \right \rfloor }i^k\right)^x\sum_{ta_1\;ta2\;…\;ta_x}\mu(t)$$</p>
<p>$枚举t得：$</p>
<p>$$\sum_{d&#x3D;1}^nd^{kx+1}f(d)\sum_{t&#x3D;1}^{\left \lfloor \frac{n}{d} \right \rfloor }\mu(t)\left (\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{dt} \right \rfloor }(it)^k\right)^x$$</p>
<p>$$\sum_{d&#x3D;1}^nd^{kx+1}f(d)\sum_{t&#x3D;1}^{\left \lfloor \frac{n}{d} \right \rfloor }\mu(t)t^{kx}\left (\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{dt} \right \rfloor }i^k\right)^x$$</p>
<p>$令T&#x3D;dt并枚举T得：$</p>
<p>$$\sum_{T&#x3D;1}^n\left (\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{dt} \right \rfloor }i^k\right)^xT^{kx}\sum_{dT}df(d)\mu(\frac{T}{d})$$</p>
<p>$令g(T)&#x3D;\sum_{dT}df(d)\mu(\frac{T}{d})，则$</p>
<p>$$\sum_{T&#x3D;1}^n\left (\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{T} \right \rfloor }i^k\right)^xT^{kx}g(T)$$</p>
<p>$\ {O(nlogn)筛f和g，并对T^{kx}g(T)和\sum_{i&#x3D;1}^{\left \lfloor \frac{n}{T} \right \rfloor }i^k做前缀和，最后\sqrt n分块计算，复杂度为O(nlogn+T\sqrt n)}$</p>
<h2 id="Code-11"><a href="#Code-11" class="headerlink" title="Code"></a>Code</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">##include &lt;bits/stdc++.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="title">std</span>;</span><br><span class="line"></span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">long</span> ll;</span><br><span class="line">typedef <span class="built_in">long</span> <span class="built_in">double</span> ld;</span><br><span class="line">typedef pair&lt;<span class="built_in">int</span>, <span class="built_in">int</span>&gt; pdd;</span><br><span class="line"></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> lowbit(x) x &amp; (-x)</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"><span class="meta">##<span class="keyword">define</span> FOR(i, x, n) for(int i = x;i &lt;= n; i++)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="keyword">const</span> ll mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="comment">// const double eps = 1e-6;</span></span><br><span class="line"><span class="comment">// const double pi = acos(-1);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="built_in">int</span> N = <span class="number">2e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">ll T, k, x;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> mu[N]; <span class="comment">// 莫比乌斯函数</span></span><br><span class="line"><span class="built_in">bool</span> <span class="keyword">is</span>\_prime[N];</span><br><span class="line"><span class="built_in">int</span> prime[N];</span><br><span class="line"><span class="built_in">int</span> cnt;</span><br><span class="line">ll g[N], f[N];</span><br><span class="line">ll sumG[N], sumi[N];</span><br><span class="line"></span><br><span class="line">ll quick\_pow(ll a, ll b) &#123;</span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b &amp; <span class="number">1</span>) ans = ans \* a % mod;</span><br><span class="line">        a = a \* a % mod;</span><br><span class="line">        b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Mobi</span>() <span class="comment">// 莫比乌斯函数初始化</span></span></span><br><span class="line">&#123;</span><br><span class="line">    f[<span class="number">1</span>] = mu[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">is</span>\_prime[<span class="number">0</span>] = <span class="keyword">is</span>\_prime[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">2</span>;i &lt; N; i++) &#123;</span><br><span class="line">        f[i] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">is</span>\_prime[i]) &#123;</span><br><span class="line">            mu[i] = <span class="number">-1</span>;</span><br><span class="line">            prime[++cnt] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">1</span>; j &lt;= cnt &amp;&amp; i \* prime[j] &lt; N; j++) &#123;</span><br><span class="line">            <span class="keyword">is</span>\_prime[i \* prime[j]] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                mu[i \* prime[j]] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i \* prime[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 筛f函数</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> d = <span class="number">2</span>;d \* d &lt; N; d++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i = d \* d;i &lt; N; i += d \* d) &#123;</span><br><span class="line">            f[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 筛g函数</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> d = <span class="number">1</span>;d &lt; N; d++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i = d;i &lt; N; i += d) &#123;</span><br><span class="line">            g[i] = (g[i] + <span class="number">1l</span>l \* d \* f[d] % mod \* mu[i / d] % mod + mod) % mod;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 处理sumG函数和sumi函数前缀和</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">1</span>;i &lt; N; i++) &#123;</span><br><span class="line">        ll t = quick\_pow(i, k);</span><br><span class="line">        sumi[i] = (sumi[i - <span class="number">1</span>] + t) % mod;</span><br><span class="line">        sumG[i] = (sumG[i - <span class="number">1</span>] + quick\_pow(t, x) \* g[i] % mod) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve</span>()</span> &#123;</span><br><span class="line">    cin &gt;&gt; T &gt;&gt; k &gt;&gt; x;</span><br><span class="line">    Mobi();</span><br><span class="line">    <span class="keyword">while</span>(T--) &#123;</span><br><span class="line">        <span class="built_in">int</span> n;</span><br><span class="line">        cin &gt;&gt; n;</span><br><span class="line">        ll ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> l = <span class="number">1</span>, r;l &lt;= n; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">            r = min(n, n / (n / l));</span><br><span class="line">            ans = (ans + (sumG[r] - sumG[l - <span class="number">1</span>] + mod) % mod \* quick\_pow(sumi[n / l], x) % mod) % mod;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">signed <span class="title">main</span>()</span> &#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">//cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">//cout.tie(nullptr);</span></span><br><span class="line"><span class="meta">##ifdef FZT\_ACM\_LOCAL</span></span><br><span class="line">    freopen(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    freopen(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    signed test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) exit(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        auto start\_clock\_for\_debug = clock();</span><br><span class="line">        solve();</span><br><span class="line">        auto end\_clock\_for\_debug = clock();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.putback(acm\_local\_for\_debug));</span><br><span class="line"><span class="meta">##<span class="keyword">else</span></span></span><br><span class="line">    solve();</span><br><span class="line"><span class="meta">##<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="huntian-oy"><a href="#huntian-oy" class="headerlink" title="huntian oy"></a><a target="_blank" rel="noopener" href="http://acm.hdu.edu.cn/showproblem.php?pid=6706">huntian oy</a></h4><p>$$求解\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^igcd(i^a-j^a,i^b-j^b)[gcd(i,j)&#x3D;1]$$</p>
<p>$$gcd(i^a-j^a,i^b-j^b)&#x3D;i^{gcd(a,b)}-j^{gcd(a,b)}$$</p>
<p>$题目说gcd(a,b)&#x3D;1，所以那个复杂的式子直接变成i-j.$</p>
<p>$$\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^i(i-j)[gcd(i,j)&#x3D;1]$$</p>
<p>$$\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^ii[gcd(i,j)&#x3D;1]-\sum_{i&#x3D;1}^n\sum_{j&#x3D;1}^ij[gcd(i,j)&#x3D;1]$$</p>
<p>$左边为与i互质的个数，右边为比i小并且互质的数字和，即为：$</p>
<p>$$\sum_{i&#x3D;1}^ni\varphi (i)-\frac{\sum_{i&#x3D;1}^ni\varphi (i)+1}{2}$$</p>
<p>$$\frac{\sum_{i&#x3D;1}^ni\varphi (i)-1}{2}$$</p>
<p>$因为n有1e9，所以需要杜教筛优化。$</p>
<p>$$f*g(n)&#x3D;\sum_{dn}f(d)g(\frac{n}{d})&#x3D;\sum_{dn}id(d)*\varphi (d)*g(\frac{n}{d})$$</p>
<p>$很显然，设g&#x3D;id，则：$</p>
<p>$$f*g(n)&#x3D;\sum_{dn}\varphi (d)id(n)&#x3D;n\sum_{dn}\varphi (d)&#x3D;id(n)(\varphi *I)&#x3D;id^2(n)&#x3D;n^2$$</p>
<p>$$所以得：S(n)&#x3D;\sum_{i&#x3D;1}^n(f*g)i-\sum_{i&#x3D;2}^ng(i)S(\frac{n}{i})&#x3D;\frac{n(n+1)(2n+1)}{6}-\sum_{i&#x3D;2}^niS(\frac{n}{i})$$</p>
<h2 id="Code-12"><a href="#Code-12" class="headerlink" title="Code"></a>Code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">#<span class="meta">#<span class="keyword">include</span> <span class="string">&quot;bits/stdc++.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; pii;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">double</span>, <span class="type">double</span>&gt; pdd;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;ll, ll&gt; pll;</span><br><span class="line"></span><br><span class="line">#<span class="meta">#<span class="keyword">define</span> endl <span class="string">&quot;\n&quot;</span></span></span><br><span class="line">#<span class="meta">#<span class="keyword">define</span> eb emplace\_back</span></span><br><span class="line">#<span class="meta">#<span class="keyword">define</span> mem(a, b) memset(a , b , sizeof(a))</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> ll INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="comment">// const ll mod = 998244353;</span></span><br><span class="line"><span class="type">const</span> ll mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> eps = <span class="number">1e-6</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> R = <span class="number">0.57721566490153286060651209</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;a)</span> </span>&#123;<span class="type">char</span> c = <span class="built_in">getchar</span>();T x = <span class="number">0</span>, f = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) &#123;<span class="keyword">if</span> (c == <span class="string">&#x27;-&#x27;</span>)f = <span class="number">-1</span>;c = <span class="built_in">getchar</span>();&#125;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) &#123;x = (x &lt;&lt; <span class="number">1</span>) + (x &lt;&lt; <span class="number">3</span>) + c - <span class="string">&#x27;0&#x27;</span>;c = <span class="built_in">getchar</span>();&#125;a = f \* x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> is\_prime[N];</span><br><span class="line"><span class="type">int</span> prime[N], cnt;</span><br><span class="line"><span class="type">int</span> phi[N];</span><br><span class="line">ll sum\_i\_phi[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>;i &lt; N; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!is\_prime[i]) prime[++cnt] = i, phi[i] = i - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>;j &lt;= cnt &amp;&amp; i \* prime[j] &lt; N; j++) &#123;</span><br><span class="line">            is\_prime[i \* prime[j]] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                phi[i \* prime[j]] = phi[i] \* prime[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> phi[i \* prime[j]] = phi[i] \* phi[prime[j]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>;i &lt; N; i++) &#123;</span><br><span class="line">        sum\_i\_phi[i] = (sum\_i\_phi[i - <span class="number">1</span>] + <span class="number">1ll</span> \* i \* phi[i] % mod) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll quick\_pow(ll a, ll b) &#123;</span><br><span class="line">    ll ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b) &#123;</span><br><span class="line">        <span class="keyword">if</span>(b &amp; <span class="number">1</span>) ans = ans \* a % mod;</span><br><span class="line">         a = a \* a % mod;</span><br><span class="line">         b &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll inv2;</span><br><span class="line">ll inv6;</span><br><span class="line"></span><br><span class="line">map&lt;ll, ll&gt; mp;</span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">S</span><span class="params">(ll x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x &lt; N) <span class="keyword">return</span> sum\_i\_phi[x];</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(mp[x]) <span class="keyword">return</span> mp[x];</span><br><span class="line">    ll ans = x \* (x + <span class="number">1</span>) % mod \* (<span class="number">2</span> \* x + <span class="number">1</span>) % mod \* inv6 % mod;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> l = <span class="number">2</span>, r;l &lt;= x; l = r + <span class="number">1</span>) &#123;</span><br><span class="line">        r = <span class="built_in">min</span>(x, x / (x / l));</span><br><span class="line">        ans = (ans - <span class="number">1ll</span> \* (r + l) % mod \* (r - l + <span class="number">1</span>) % mod \* inv2 % mod \* <span class="built_in">S</span>(x / l)) % mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mp[x] = ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    inv2 = quick\_pow(<span class="number">2</span>, mod - <span class="number">2</span>);</span><br><span class="line">    inv6 = quick\_pow(<span class="number">6</span>, mod - <span class="number">2</span>);</span><br><span class="line">    <span class="type">int</span> \_; <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;\_);</span><br><span class="line">    <span class="keyword">while</span>(\_--) &#123;</span><br><span class="line">        ll n, a, b; <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld%lld&quot;</span>,&amp;n,&amp;a,&amp;b);</span><br><span class="line">        ll ans = (<span class="built_in">S</span>(n) - <span class="number">1</span>) % mod;</span><br><span class="line">        ans = ans \* inv2 % mod;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,(ans % mod + mod) % mod);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">// cout.tie(nullptr);</span></span><br><span class="line">#<span class="meta">#<span class="keyword">ifdef</span> FZT\_ACM\_LOCAL</span></span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    <span class="type">signed</span> test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        <span class="keyword">auto</span> start\_clock\_for\_debug = <span class="built_in">clock</span>();</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">        <span class="keyword">auto</span> end\_clock\_for\_debug = <span class="built_in">clock</span>();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.<span class="built_in">putback</span>(acm\_local\_for\_debug));</span><br><span class="line">#<span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="built_in">solve</span>();</span><br><span class="line">#<span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="HDU-6428-Problem-C-Calculate"><a href="#HDU-6428-Problem-C-Calculate" class="headerlink" title="HDU 6428 Problem C. Calculate"></a><a target="_blank" rel="noopener" href="http://acm.hdu.edu.cn/showproblem.php?pid=6428">HDU 6428 Problem C. Calculate</a></h4><p>$$求解\sum_{i&#x3D;1}^A\sum_{j&#x3D;1}^B\sum_{k&#x3D;1}^C\phi (gcd(i,j^2,k^3))\;\;mod\;\;2^{30}$$</p>
<p>$首先要把\phi和gcd分开，即\phi(n)&#x3D;\sum_{dn}(\phi*\mu)(d)，证明如下：$ $$\phi(n)&#x3D;(\mu*id)(n)$$</p>
<p>$$\sum_{dn}\mu(d)\frac{n}{d}$$</p>
<p>$$\sum_{dn}\mu(d)\sum_{d’\frac{n}{d}}\phi(d’)$$</p>
<p>$$\sum_{dd’n}\mu(d)\phi(d’)$$</p>
<p>$$\sum_{dn}\sum_{d’d}\mu(d’)\phi(\frac{d}{d’})$$</p>
<p>$$\sum_{dn}(\phi*\mu)(d)$$</p>
<p>$所以原式变为：$</p>
<p>$$\sum_{i&#x3D;1}^A\sum_{j&#x3D;1}^B\sum_{k&#x3D;1}^C\sum_{di\;dj^2\;dk^3}(\phi*\mu)(d)$$</p>
<p>$$\sum_{d&#x3D;1}^{A}(\phi*\mu)(d)\sum_{i&#x3D;1\;di}^A\sum_{j&#x3D;1\;dj^2}^B\sum_{k&#x3D;1\;dk^3}^C1$$ \left \lceil \right \rceil $观察后面式子，对于一个x^k，若dx^k，先把d分解为\prod p_i^{a_i}.$ $则\prod p_i^{a_i}x^k，得\prod p_i^{\left \lceil \frac{a_i}{k} \right \rceil }x，所以设$</p>
<p>$$f_k(n)&#x3D;\prod p_i^{\left \lceil \frac{a_i}{k} \right \rceil }$$</p>
<p>$则：$</p>
<p>$$ans&#x3D;\sum_{d&#x3D;1}^{A}(\phi * \mu)(d)\frac{A}{f_1(d)}\frac{B}{f_2(d)}\frac{C}{f_3(d)}$$</p>
<p>$对于f_k(n)，类似分解n的形式。$ $分解质因子的过程中，记录质因子的指数，每次质因子+1时，若\%k&#x3D;1时，说明该向上取整了，于是f_k(n)*&#x3D;该质因子.$</p>
<p>$由于\phi和\mu都是积性函数，卷积之后还是积性函数，设g(d)&#x3D;(\phi*\mu)(d)，则$</p>
<p>$$\phi(n)&#x3D;\sum_{dn}g(d)$$</p>
<p>$那么可以得：$</p>
<p>$$\phi(p^k)&#x3D;\phi(p^{k-1})+g(p^k)$$</p>
<p>$$g(p^k)&#x3D;\phi(p^k)-\phi(p^{k-1})$$</p>
<p>$$g(p^k)&#x3D;(p-1)p^{k-1}-(p-1)p^{k-2}$$</p>
<p>$$g(p^k)&#x3D;(p-1)^2p^{k-2}$$</p>
<p>$当我们欧拉筛的过程中：$</p>
<p>$$g(1)&#x3D;1$$</p>
<p>$$g(p)&#x3D;p-2$$</p>
<p>$$g(p^{k})&#x3D;(p-1)^2p^{k-2}$$</p>
<p>$$g(p_1^{k_1}p_2^{k_2})&#x3D;g(p_1^{k_1})g(p_2^{k_2})$$</p>
<p>$$……$$</p>
<h2 id="Code-13"><a href="#Code-13" class="headerlink" title="Code"></a>Code</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">#<span class="meta">#<span class="keyword">include</span> <span class="string">&quot;bits/stdc++.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> <span class="type">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> ll mod = (<span class="number">1ll</span> &lt;&lt; <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e7</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">bool</span> is\_prime[N];</span><br><span class="line"><span class="type">int</span> prime[N], cnt;</span><br><span class="line"><span class="type">int</span> g[N];</span><br><span class="line"><span class="type">int</span> f1[N], f2[N], f3[N];</span><br><span class="line"><span class="type">int</span> deg[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    f1[<span class="number">1</span>] = f2[<span class="number">1</span>] = f3[<span class="number">1</span>] = g[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>;i &lt; N; i++) &#123;</span><br><span class="line">        f1[i] = i;</span><br><span class="line">        <span class="keyword">if</span>(!is\_prime[i]) prime[++cnt] = f2[i] = f3[i] = i, g[i] = i - <span class="number">2</span>, deg[i] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>;j &lt;= cnt &amp;&amp; i \* prime[j] &lt; N; j++) &#123;</span><br><span class="line">            <span class="type">int</span> now = i \* prime[j];</span><br><span class="line">            is\_prime[now] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                deg[now] = deg[i] + <span class="number">1</span>;</span><br><span class="line">                <span class="type">int</span> num = <span class="number">1</span>, tmp = i;</span><br><span class="line">                <span class="keyword">while</span>(num &lt;= <span class="number">3</span> &amp;&amp; tmp % prime[j] == <span class="number">0</span>) num++, tmp /= prime[j];</span><br><span class="line">                <span class="keyword">if</span>(num == <span class="number">1</span>) g[now] = g[i] \* g[prime[j]];</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(num == <span class="number">2</span>) g[now] = g[i / prime[j]] \* (prime[j] - <span class="number">1</span>) \* (prime[j] - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">else</span> g[now] = g[i] \* prime[j];</span><br><span class="line">                f2[now] = f2[i] \* (deg[now] % <span class="number">2</span> == <span class="number">1</span> ? prime[j] : <span class="number">1</span>);</span><br><span class="line">                f3[now] = f3[i] \* (deg[now] % <span class="number">3</span> == <span class="number">1</span> ? prime[j] : <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                deg[now] = <span class="number">1</span>;</span><br><span class="line">                f2[now] = f2[i] \* f2[prime[j]];</span><br><span class="line">                f3[now] = f3[i] \* f3[prime[j]];</span><br><span class="line">                g[now] = g[i] \* g[prime[j]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="type">int</span> \_; <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;\_);</span><br><span class="line">    <span class="keyword">while</span>(\_--) &#123;</span><br><span class="line">        <span class="type">int</span> A, B, C; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>,&amp;A,&amp;B,&amp;C);</span><br><span class="line">        ll ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> d = <span class="number">1</span>;d &lt;= A; d++) &#123;</span><br><span class="line">            ans = (ans + <span class="number">1ll</span> \* g[d] \* (A / f1[d]) % mod \* (B / f2[d]) % mod \* (C / f3[d]) % mod) % mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,(ans % mod + mod) % mod);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios\_base::sync\_with\_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// cin.tie(nullptr);</span></span><br><span class="line">    <span class="comment">// cout.tie(nullptr);</span></span><br><span class="line">#<span class="meta">#<span class="keyword">ifdef</span> FZT\_ACM\_LOCAL</span></span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;in.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">    <span class="type">signed</span> test\_index\_for\_debug = <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span> acm\_local\_for\_debug = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acm\_local\_for\_debug == <span class="string">&#x27;$&#x27;</span>) <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (test\_index\_for\_debug &gt; <span class="number">20</span>)</span><br><span class="line">            <span class="keyword">throw</span> runtime\_error(<span class="string">&quot;Check the stdin!!!&quot;</span>);</span><br><span class="line">        <span class="keyword">auto</span> start\_clock\_for\_debug = <span class="built_in">clock</span>();</span><br><span class="line">        <span class="built_in">solve</span>();</span><br><span class="line">        <span class="keyword">auto</span> end\_clock\_for\_debug = <span class="built_in">clock</span>();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug &lt;&lt; <span class="string">&quot; successful&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cerr &lt;&lt; <span class="string">&quot;Test &quot;</span> &lt;&lt; test\_index\_for\_debug++ &lt;&lt; <span class="string">&quot; Run Time: &quot;</span></span><br><span class="line">             &lt;&lt; <span class="built_in">double</span>(end\_clock\_for\_debug - start\_clock\_for\_debug) / CLOCKS\_PER\_SEC &lt;&lt; <span class="string">&quot;s&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;--------------------------------------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125; <span class="keyword">while</span> (cin &gt;&gt; acm\_local\_for\_debug &amp;&amp; cin.<span class="built_in">putback</span>(acm\_local\_for\_debug));</span><br><span class="line">#<span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="built_in">solve</span>();</span><br><span class="line">#<span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><b>本文作者：jujimeizuo</b><br /><b>本文地址<b/>： <a href="https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/">https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/</a> <br /><b>本博客所有文章除特别声明外，均采用 CC BY-SA 3.0 协议。转载请注明出处！</b></p>

  </div>
</article>



<script src="https://giscus.app/client.js"
        data-repo="jujimeizuo/Blog"
        data-repo-id="R_kgDOLoFA2Q"
        data-category="Announcements"
        data-category-id="DIC_kwDOLoFA2c4CeXmK"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Articles</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/jujimeizuo/">Projects</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://note.jujimeizuo.cn/">Note</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83%EF%BC%9A%E5%A4%A7%E4%BD%AC1-%E5%A4%A7%E4%BD%AC2-%E5%A4%A7%E4%BD%AC3-%E5%A4%A7%E4%BD%AC4"><span class="toc-number">1.</span> <span class="toc-text">参考：大佬1 大佬2 大佬3 大佬4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#P3455-POI2007-ZAP-Queries"><span class="toc-number">2.</span> <span class="toc-text">P3455 [POI2007]ZAP-Queries</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P2257-YY%E7%9A%84GCD"><span class="toc-number">1.</span> <span class="toc-text">P2257 YY的GCD</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-1"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P1390-%E5%85%AC%E7%BA%A6%E6%95%B0%E7%9A%84%E5%92%8C"><span class="toc-number">1.</span> <span class="toc-text">P1390 公约数的和</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-2"><span class="toc-number"></span> <span class="toc-text">Code</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#P1829-%E5%9B%BD%E5%AE%B6%E9%9B%86%E8%AE%AD%E9%98%9F-Crash%E7%9A%84%E6%95%B0%E5%AD%97%E8%A1%A8%E6%A0%BC-JZPTAB"><span class="toc-number"></span> <span class="toc-text">P1829 [国家集训队]Crash的数字表格 &#x2F; JZPTAB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-3"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P3768-%E7%AE%80%E5%8D%95%E7%9A%84%E6%95%B0%E5%AD%A6%E9%A2%98"><span class="toc-number">1.</span> <span class="toc-text">P3768 简单的数学题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-4"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P3327-SDOI2015-%E7%BA%A6%E6%95%B0%E4%B8%AA%E6%95%B0%E5%92%8C"><span class="toc-number">1.</span> <span class="toc-text">P3327 [SDOI2015]约数个数和</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-5"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P3312-SDOI2014-%E6%95%B0%E8%A1%A8"><span class="toc-number">1.</span> <span class="toc-text">P3312 [SDOI2014]数表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-6"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P3172-CQOI2015-%E9%80%89%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">P3172 [CQOI2015]选数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-7"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AT5200-AGC038C-LCMs"><span class="toc-number">1.</span> <span class="toc-text">AT5200 [AGC038C] LCMs</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-8"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SP5971-LCMSUM-LCM-Sum"><span class="toc-number">1.</span> <span class="toc-text">SP5971 LCMSUM - LCM Sum</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-9"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P5221-Product"><span class="toc-number">1.</span> <span class="toc-text">P5221 Product</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-10"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HDU-6588-Function"><span class="toc-number">1.</span> <span class="toc-text">HDU 6588 Function</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HDU-6833-A-Very-Easy-Math-Problem"><span class="toc-number">2.</span> <span class="toc-text">HDU 6833 A Very Easy Math Problem</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-11"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#huntian-oy"><span class="toc-number">1.</span> <span class="toc-text">huntian oy</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-12"><span class="toc-number"></span> <span class="toc-text">Code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HDU-6428-Problem-C-Calculate"><span class="toc-number">1.</span> <span class="toc-text">HDU 6428 Problem C. Calculate</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-13"><span class="toc-number"></span> <span class="toc-text">Code</span></a>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&text=莫比乌斯反演例题集---（自用）"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&title=莫比乌斯反演例题集---（自用）"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&is_video=false&description=莫比乌斯反演例题集---（自用）"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=莫比乌斯反演例题集---（自用）&body=Check out this article: https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&title=莫比乌斯反演例题集---（自用）"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&title=莫比乌斯反演例题集---（自用）"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&title=莫比乌斯反演例题集---（自用）"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&title=莫比乌斯反演例题集---（自用）"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&name=莫比乌斯反演例题集---（自用）&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://blog.jujimeizuo.cn/2020/08/10/mobius-inversion/&t=莫比乌斯反演例题集---（自用）"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2025
    jujimeizuo
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
      --><li><a href="/">Home</a></li><!--
    --><!--
      --><li><a href="/about/">About</a></li><!--
    --><!--
      --><li><a href="/archives/">Articles</a></li><!--
    --><!--
      --><li><a target="_blank" rel="noopener" href="https://github.com/jujimeizuo/">Projects</a></li><!--
    --><!--
      --><li><a target="_blank" rel="noopener" href="https://note.jujimeizuo.cn/">Note</a></li><!--
    --><!--
      --><li><a href="/search/">Search</a></li><!--
    -->
      </ul>
      <ul>
        
          <!-- 不蒜子统计 -->
          <span id="busuanzi_container_site_pv">
              本站总访问量<span id="busuanzi_value_site_pv"></span>次
          </span>
          <span class="post-meta-divider">|</span>
          <span id="busuanzi_container_site_uv" style='display:none'>
                  本站访客数<span id="busuanzi_value_site_uv"></span>人
          </span>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        
      </ul>
    </nav>
  </div>
  
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?ef9689758a12d2cdf6b9e8642a8604d9";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
